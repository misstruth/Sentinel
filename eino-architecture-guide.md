# Sentinel é¡¹ç›®æ¶æ„æ–‡æ¡£
## åŸºäº Eino æ¡†æ¶çš„æ™ºèƒ½ Agent ç³»ç»Ÿè®¾è®¡ä¸å®ç°

---

# ç›®å½•

1. [é¡¹ç›®æ¦‚è¿°ä¸æ¶æ„æ€»è§ˆ](#ç¬¬ä¸€ç« -é¡¹ç›®æ¦‚è¿°ä¸æ¶æ„æ€»è§ˆ)
2. [Eino æ¡†æ¶åŸºç¡€ä¸æ ¸å¿ƒæ¦‚å¿µ](#ç¬¬äºŒç« -eino-æ¡†æ¶åŸºç¡€ä¸æ ¸å¿ƒæ¦‚å¿µ)
3. [èŠå¤© Agent æµæ°´çº¿è¯¦è§£](#ç¬¬ä¸‰ç« -èŠå¤©-agent-æµæ°´çº¿è¯¦è§£)
4. [çŸ¥è¯†åº“ç´¢å¼•æµæ°´çº¿è¯¦è§£](#ç¬¬å››ç« -çŸ¥è¯†åº“ç´¢å¼•æµæ°´çº¿è¯¦è§£)
5. [Tool å·¥å…·ç³»ç»Ÿè¯¦è§£](#ç¬¬äº”ç« -tool-å·¥å…·ç³»ç»Ÿè¯¦è§£)
6. [æ¨¡å‹ä¸ Embedding é›†æˆ](#ç¬¬å…­ç« -æ¨¡å‹ä¸-embedding-é›†æˆ)
7. [å‘é‡æ£€ç´¢ä¸å­˜å‚¨ç³»ç»Ÿ](#ç¬¬ä¸ƒç« -å‘é‡æ£€ç´¢ä¸å­˜å‚¨ç³»ç»Ÿ)
8. [Multi-Agent Supervisor å¤šæ™ºèƒ½ä½“æ¶æ„](#ç¬¬å…«ç« -multi-agent-supervisor-å¤šæ™ºèƒ½ä½“æ¶æ„)
9. [Plan-Execute-Replan æ¨¡å¼](#ç¬¬ä¹ç« -plan-execute-replan-æ¨¡å¼)
10. [Skill æŠ€èƒ½ç³»ç»Ÿ](#ç¬¬åç« -skill-æŠ€èƒ½ç³»ç»Ÿ)
11. [API å±‚ä¸æœåŠ¡é›†æˆ](#ç¬¬åä¸€ç« -api-å±‚ä¸æœåŠ¡é›†æˆ)
12. [ç³»ç»Ÿä¼˜åŒ–ä¸å·¥ç¨‹å®è·µ](#ç¬¬åäºŒç« -ç³»ç»Ÿä¼˜åŒ–ä¸å·¥ç¨‹å®è·µ)
13. [é…ç½®ç®¡ç†ä¸éƒ¨ç½²](#ç¬¬åä¸‰ç« -é…ç½®ç®¡ç†ä¸éƒ¨ç½²)

---

# ç¬¬ä¸€ç«  é¡¹ç›®æ¦‚è¿°ä¸æ¶æ„æ€»è§ˆ

## 1.1 é¡¹ç›®ç®€ä»‹

Sentinel æ˜¯ä¸€ä¸ªåŸºäºå­—èŠ‚è·³åŠ¨å¼€æºçš„ Eino æ¡†æ¶æ„å»ºçš„ä¼ä¸šçº§æ™ºèƒ½ Agent ç³»ç»Ÿã€‚è¯¥ç³»ç»Ÿä¸»è¦é¢å‘å®‰å…¨è¿ç»´åœºæ™¯ï¼Œæä¾›æ™ºèƒ½å¯¹è¯ã€å‘Šè­¦åˆ†æã€çŸ¥è¯†åº“æ£€ç´¢ã€è‡ªåŠ¨åŒ–è¿ç»´ç­‰æ ¸å¿ƒèƒ½åŠ›ã€‚

### 1.1.1 é¡¹ç›®å®šä½

Sentinel å®šä½ä¸ºä¼ä¸šçº§ AI è¿ç»´åŠ©æ‰‹ï¼Œå…·å¤‡ä»¥ä¸‹æ ¸å¿ƒç‰¹æ€§ï¼š

- **å¤šæ™ºèƒ½ä½“åä½œ**ï¼šåŸºäº Supervisor æ¨¡å¼çš„å¤š Agent æ¶æ„ï¼Œæ”¯æŒæ„å›¾è·¯ç”±ã€ä»»åŠ¡åˆ†å‘å’Œè·¨ Agent ä¸Šä¸‹æ–‡å…±äº«
- **æ™ºèƒ½å¯¹è¯èƒ½åŠ›**ï¼šåŸºäº ReAct Agent æ¨¡å¼ï¼Œæ”¯æŒå¤šè½®å¯¹è¯å’Œå·¥å…·è°ƒç”¨
- **çŸ¥è¯†åº“å¢å¼º**ï¼šé›†æˆ RAGï¼ˆæ£€ç´¢å¢å¼ºç”Ÿæˆï¼‰æŠ€æœ¯ï¼ŒåŸºäº Milvus å‘é‡æ•°æ®åº“å®ç°è¯­ä¹‰æ£€ç´¢
- **è‡ªåŠ¨åŒ–è¿ç»´**ï¼šæ”¯æŒ Prometheus å‘Šè­¦åˆ†æã€æ—¥å¿—æŸ¥è¯¢ã€å®‰å…¨äº‹ä»¶åˆ†æã€é£é™©è¯„ä¼°ç­‰è¿ç»´ä»»åŠ¡
- **è®¡åˆ’æ‰§è¡Œèƒ½åŠ›**ï¼šåŸºäº Eino ADK çš„ Plan-Execute-Replan æ¨¡å¼ï¼Œå¤„ç†å¤æ‚å¤šæ­¥éª¤ä»»åŠ¡
- **æŠ€èƒ½ç³»ç»Ÿ**ï¼šå†…ç½®äº‹ä»¶åˆ†æã€æ—¥å¿—è¯Šæ–­ã€å¨èƒç‹©çŒç­‰é¢„å®šä¹‰æŠ€èƒ½ï¼Œæ”¯æŒå‚æ•°åŒ–æ‰§è¡Œ
- **å¯æ‰©å±•æ¶æ„**ï¼šåŸºäº Eino æ¡†æ¶çš„ Graph ç¼–æ’ï¼Œæ”¯æŒçµæ´»çš„æµæ°´çº¿å®šåˆ¶

### 1.1.2 æŠ€æœ¯æ ˆæ¦‚è§ˆ

| æŠ€æœ¯é¢†åŸŸ | æŠ€æœ¯é€‰å‹ | ç‰ˆæœ¬ |
|---------|---------|------|
| AI æ¡†æ¶ | Eino (CloudWeGo) | v0.7.13 |
| Agent å¼€å‘å¥—ä»¶ | Eino ADK | v0.7.13 |
| MCP åè®® | mcp-go | v0.42.0 |
| Web æ¡†æ¶ | GoFrame | v2.7.1 |
| å‘é‡æ•°æ®åº“ | Milvus | v2.4.2 |
| å…³ç³»æ•°æ®åº“ | MySQL (GORM) | v1.31.0 |
| LLM æ¨¡å‹ | DeepSeek V3 / V3-Think | - |
| Embedding | è±†åŒ… (ARK) | 1024 ç»´ |
| è¯­è¨€ç‰ˆæœ¬ | Go | 1.24.0 |

## 1.2 é¡¹ç›®ç›®å½•ç»“æ„

```
Sentinel/
â”œâ”€â”€ api/                              # API å®šä¹‰å±‚
â”‚   â”œâ”€â”€ chat/v1/                      # èŠå¤© & Supervisor API
â”‚   â”œâ”€â”€ event/v1/                     # äº‹ä»¶ç®¡ç† & Pipeline æµå¼ API
â”‚   â”œâ”€â”€ report/v1/                    # æŠ¥å‘Šç”Ÿæˆ API
â”‚   â”œâ”€â”€ skill/v1/                     # æŠ€èƒ½æ‰§è¡Œ API
â”‚   â””â”€â”€ subscription/v1/             # è®¢é˜…ç®¡ç† API
â”œâ”€â”€ cmd/cli/                          # CLI å‘½ä»¤è¡Œå…¥å£
â”œâ”€â”€ internal/                         # å†…éƒ¨å®ç°
â”‚   â”œâ”€â”€ ai/                           # AI æ ¸å¿ƒæ¨¡å— â­
â”‚   â”‚   â”œâ”€â”€ agent/                    # Agent æµæ°´çº¿é›†åˆ
â”‚   â”‚   â”‚   â”œâ”€â”€ supervisor/           # ğŸ†• å¤š Agent è°ƒåº¦å™¨ï¼ˆè·¯ç”±/æ‰§è¡Œ/æ³¨å†Œ/è®°å¿†ï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ chat_pipeline/        # èŠå¤© Agentï¼ˆRAG + ReActï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ event_analysis_pipeline/  # äº‹ä»¶åˆ†æ Agent
â”‚   â”‚   â”‚   â”œâ”€â”€ report_pipeline/      # æŠ¥å‘Šç”Ÿæˆ Agent
â”‚   â”‚   â”‚   â”œâ”€â”€ risk_pipeline/        # é£é™©è¯„ä¼° Agent
â”‚   â”‚   â”‚   â”œâ”€â”€ plan_execute_replan/  # Plan-Execute-Replan Agent
â”‚   â”‚   â”‚   â”œâ”€â”€ event_extraction/     # äº‹ä»¶æå–æµæ°´çº¿
â”‚   â”‚   â”‚   â”œâ”€â”€ event_dedup/          # äº‹ä»¶å»é‡æµæ°´çº¿
â”‚   â”‚   â”‚   â”œâ”€â”€ event_indexer/        # äº‹ä»¶å‘é‡ç´¢å¼•
â”‚   â”‚   â”‚   â”œâ”€â”€ event_pipeline/       # äº‹ä»¶å¤„ç†æµæ°´çº¿
â”‚   â”‚   â”‚   â”œâ”€â”€ knowledge_index_pipeline/  # çŸ¥è¯†åº“ç´¢å¼•æµæ°´çº¿
â”‚   â”‚   â”‚   â”œâ”€â”€ report_generator/     # æŠ¥å‘Šç”Ÿæˆå™¨
â”‚   â”‚   â”‚   â””â”€â”€ risk_assessment/      # é£é™©è¯„ä¼°å¼•æ“
â”‚   â”‚   â”œâ”€â”€ skills/                   # ğŸ†• æŠ€èƒ½ç³»ç»Ÿ
â”‚   â”‚   â”‚   â”œâ”€â”€ builtin/              # å†…ç½®æŠ€èƒ½ï¼ˆäº‹ä»¶åˆ†æ/æ—¥å¿—è¯Šæ–­/å¨èƒç‹©çŒï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ executor.go           # æŠ€èƒ½æ‰§è¡Œå™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ registry.go           # æŠ€èƒ½æ³¨å†Œè¡¨
â”‚   â”‚   â”‚   â””â”€â”€ types.go              # æŠ€èƒ½ç±»å‹å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ embedder/                 # Embedding ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ indexer/                  # ç´¢å¼•ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ models/                   # æ¨¡å‹é…ç½®ï¼ˆDeepSeek V3/V3-Thinkï¼‰
â”‚   â”‚   â”œâ”€â”€ retriever/                # Milvus æ£€ç´¢ç»„ä»¶
â”‚   â”‚   â””â”€â”€ tools/                    # å·¥å…·é›†åˆï¼ˆ10+ å·¥å…·ï¼‰
â”‚   â”œâ”€â”€ controller/                   # æ§åˆ¶å™¨å±‚ï¼ˆchat/event/report/skill/...ï¼‰
â”‚   â”œâ”€â”€ logic/                        # ä¸šåŠ¡é€»è¾‘å±‚ï¼ˆchat/event/report/sse/...ï¼‰
â”‚   â”œâ”€â”€ database/                     # æ•°æ®åº“åˆå§‹åŒ–ä¸è¿ç§»
â”‚   â”œâ”€â”€ middleware/                   # HTTP ä¸­é—´ä»¶
â”‚   â”œâ”€â”€ auth/                         # JWT & RBAC è®¤è¯
â”‚   â”œâ”€â”€ cache/                        # ç¼“å­˜å±‚
â”‚   â”œâ”€â”€ scheduler/                    # ä»»åŠ¡è°ƒåº¦
â”‚   â”œâ”€â”€ notify/                       # é€šçŸ¥ä¸ Webhook
â”‚   â””â”€â”€ ...                           # å…¶ä»–ä¸šåŠ¡æ¨¡å—
â”œâ”€â”€ utility/                          # å·¥å…·ç±»
â”‚   â”œâ”€â”€ client/                       # Milvus å®¢æˆ·ç«¯åˆå§‹åŒ–
â”‚   â”œâ”€â”€ common/                       # å…¬å…±å¸¸é‡
â”‚   â”œâ”€â”€ log_call_back/                # æ—¥å¿—å›è°ƒ
â”‚   â””â”€â”€ mem/                          # å†…å­˜ç®¡ç†
â””â”€â”€ go.mod                            # ä¾èµ–ç®¡ç†ï¼ˆGo 1.24ï¼‰
```

## 1.3 ç³»ç»Ÿæ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Sentinel ç³»ç»Ÿæ¶æ„                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                      API å±‚ (GoFrame :6872)                        â”‚  â”‚
â”‚  â”‚  /api/chat/*  /api/event/*  /api/report/*  /api/skill/*  /api/sub/*â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                               â–¼                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                    Controller â†’ Logic â†’ SSE                        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                               â–¼                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                  Supervisor (Host Agent) â­                         â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚  Router   â”‚â”€â”€â”€â–¶â”‚   Executor   â”‚â”€â”€â”€â–¶â”‚     SharedMemory        â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ (LLMæ„å›¾  â”‚    â”‚ (Agentåˆ†å‘)  â”‚    â”‚ (åˆ†å±‚ä¸Šä¸‹æ–‡/è‡ªåŠ¨å‹ç¼©)    â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  åˆ†ç±»)    â”‚    â”‚              â”‚    â”‚                          â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚                         â”‚ è·¯ç”±åˆ†å‘                                  â”‚  â”‚
â”‚  â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”                          â”‚  â”‚
â”‚  â”‚         â–¼       â–¼       â–¼       â–¼       â–¼                          â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”                      â”‚  â”‚
â”‚  â”‚  â”‚ChatAgent â”‚â”‚Event â”‚â”‚Reportâ”‚â”‚Risk â”‚â”‚Plan  â”‚                      â”‚  â”‚
â”‚  â”‚  â”‚RAG+ReAct â”‚â”‚Agent â”‚â”‚Agent â”‚â”‚Agentâ”‚â”‚Agent â”‚                      â”‚  â”‚
â”‚  â”‚  â”‚          â”‚â”‚      â”‚â”‚      â”‚â”‚     â”‚â”‚PER   â”‚                      â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”˜                      â”‚  â”‚
â”‚  â”‚   æ¯ä¸ª SubAgent å†…éƒ¨: InputToRagâ†’Milvusâ†’Templateâ†’ReAct             â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                               â”‚                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                      Tools å·¥å…·é›† (10+)                             â”‚  â”‚
â”‚  â”‚  Events â”‚ Alerts â”‚ Logs(MCP) â”‚ Docs â”‚ Reports â”‚ Subscriptions     â”‚  â”‚
â”‚  â”‚  MySQL  â”‚ CurrentTime â”‚ SimilarEvents â”‚ EventDetail                â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                               â–¼                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                         å¤–éƒ¨æœåŠ¡å±‚                                  â”‚  â”‚
â”‚  â”‚  Milvus(å‘é‡åº“)  MySQL(å…³ç³»åº“)  Prometheus  DeepSeek  è±†åŒ…ARK      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 1.4 æ ¸å¿ƒä¾èµ–åˆ†æ

é¡¹ç›®çš„æ ¸å¿ƒä¾èµ–å®šä¹‰åœ¨ `go.mod` æ–‡ä»¶ä¸­ï¼š

**æ–‡ä»¶ä½ç½®**: `/go.mod`

```go
module Sentinel

go 1.24.0

require (
    // Eino æ ¸å¿ƒæ¡†æ¶
    github.com/cloudwego/eino v0.7.13
    github.com/cloudwego/eino-examples v0.0.0-20250929123132-bbbae0931948

    // Eino æ‰©å±•ç»„ä»¶ - Embedding
    github.com/cloudwego/eino-ext/components/embedding/dashscope v0.0.0-20260109062358-b9080dbc7bed

    // Eino æ‰©å±•ç»„ä»¶ - å‘é‡å­˜å‚¨
    github.com/cloudwego/eino-ext/components/indexer/milvus v0.0.0-20251011073417-75b93b87b8a9
    github.com/cloudwego/eino-ext/components/retriever/milvus v0.0.0-20251011073417-75b93b87b8a9

    // Eino æ‰©å±•ç»„ä»¶ - æ¨¡å‹
    github.com/cloudwego/eino-ext/components/model/ark v0.1.64
    github.com/cloudwego/eino-ext/components/model/openai v0.1.1

    // Eino æ‰©å±•ç»„ä»¶ - å·¥å…·
    github.com/cloudwego/eino-ext/components/tool/mcp v0.0.5
    github.com/cloudwego/eino-ext/components/tool/duckduckgo/v2 v2.0.0-20250826125654-37d4a5029810

    // Eino æ‰©å±•ç»„ä»¶ - æ–‡æ¡£å¤„ç†
    github.com/cloudwego/eino-ext/components/document/loader/file v0.0.0-20251022075257-f53d64495d2f
    github.com/cloudwego/eino-ext/components/document/transformer/splitter/markdown v0.0.0-20251022075257-f53d64495d2f

    // Web æ¡†æ¶
    github.com/gogf/gf/v2 v2.7.1

    // å‘é‡æ•°æ®åº“å®¢æˆ·ç«¯
    github.com/milvus-io/milvus-sdk-go/v2 v2.4.2

    // MCP åè®®æ”¯æŒ
    github.com/mark3labs/mcp-go v0.42.0

    // æ•°æ®åº“
    gorm.io/driver/mysql v1.6.0
    gorm.io/gorm v1.31.0
)
```

### 1.4.1 Eino ç»„ä»¶ä¾èµ–å…³ç³»å›¾

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   eino (æ ¸å¿ƒæ¡†æ¶)    â”‚
                    â”‚      v0.7.13        â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚                   â”‚                   â”‚
           â–¼                   â–¼                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    compose      â”‚ â”‚    schema       â”‚ â”‚   components    â”‚
â”‚  (å›¾ç¼–æ’å¼•æ“)    â”‚ â”‚  (æ•°æ®ç»“æ„)     â”‚ â”‚   (ç»„ä»¶æ¥å£)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                  â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                    â”‚                    â”‚                    â”‚                    â”‚
        â–¼                    â–¼                    â–¼                    â–¼                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    model     â”‚   â”‚  embedding   â”‚   â”‚  retriever   â”‚   â”‚   indexer    â”‚   â”‚    tool      â”‚
â”‚   (æ¨¡å‹)     â”‚   â”‚ (å‘é‡åŒ–)     â”‚   â”‚   (æ£€ç´¢)     â”‚   â”‚   (ç´¢å¼•)     â”‚   â”‚   (å·¥å…·)     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                  â”‚                  â”‚                  â”‚                  â”‚
       â–¼                  â–¼                  â–¼                  â–¼                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚model/openai  â”‚   â”‚embedding/ark â”‚   â”‚retriever/    â”‚   â”‚indexer/      â”‚   â”‚ tool/mcp     â”‚
â”‚              â”‚   â”‚              â”‚   â”‚milvus        â”‚   â”‚milvus        â”‚   â”‚ tool/duckgo  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 1.5 æ•°æ®æµæ¦‚è§ˆ

### 1.5.1 èŠå¤©è¯·æ±‚æ•°æ®æµ

```
ç”¨æˆ·è¯·æ±‚                                                              æœ€ç»ˆå“åº”
   â”‚                                                                     â–²
   â–¼                                                                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ HTTP â”‚â”€â”€â”€â–¶â”‚Controllerâ”‚â”€â”€â”€â–¶â”‚BuildChatAgentâ”‚â”€â”€â”€â–¶â”‚  Invoke  â”‚â”€â”€â”€â–¶â”‚ Response â”‚
â”‚ POST â”‚    â”‚  Chat()  â”‚    â”‚   Graph    â”‚    â”‚  æ‰§è¡Œ    â”‚    â”‚  è¿”å›    â”‚
â””â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚      Graph å†…éƒ¨æµç¨‹      â”‚
                    â”‚                         â”‚
                    â”‚  START                  â”‚
                    â”‚    â”‚                    â”‚
                    â”‚    â”œâ”€â”€â–¶ InputToRag      â”‚
                    â”‚    â”‚        â”‚           â”‚
                    â”‚    â”‚        â–¼           â”‚
                    â”‚    â”‚   MilvusRetriever  â”‚
                    â”‚    â”‚        â”‚           â”‚
                    â”‚    â”‚        â–¼           â”‚
                    â”‚    â””â”€â”€â–¶ ChatTemplate â—€â”€â”€â”¤
                    â”‚              â”‚          â”‚
                    â”‚              â–¼          â”‚
                    â”‚         ReactAgent      â”‚
                    â”‚              â”‚          â”‚
                    â”‚              â–¼          â”‚
                    â”‚            END          â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.5.2 çŸ¥è¯†ç´¢å¼•æ•°æ®æµ

```
æ–‡æ¡£æº                                                              ç´¢å¼•å®Œæˆ
   â”‚                                                                   â–²
   â–¼                                                                   â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ File â”‚â”€â”€â”€â–¶â”‚FileLoaderâ”‚â”€â”€â”€â–¶â”‚ Markdown â”‚â”€â”€â”€â–¶â”‚ Milvus   â”‚â”€â”€â”€â–¶â”‚  IDs     â”‚
â”‚ .md  â”‚    â”‚          â”‚    â”‚ Splitter â”‚    â”‚ Indexer  â”‚    â”‚  è¿”å›    â”‚
â””â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â–¼
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â”‚   Embedding   â”‚
                         â”‚   å‘é‡åŒ–å¤„ç†   â”‚
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

# ç¬¬äºŒç«  Eino æ¡†æ¶åŸºç¡€ä¸æ ¸å¿ƒæ¦‚å¿µ

## 2.1 Eino æ¡†æ¶ç®€ä»‹

Eino æ˜¯å­—èŠ‚è·³åŠ¨ CloudWeGo å›¢é˜Ÿå¼€æºçš„ Go è¯­è¨€ AI åº”ç”¨å¼€å‘æ¡†æ¶ï¼Œä¸“æ³¨äºæ„å»ºåŸºäºå¤§è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰çš„æ™ºèƒ½åº”ç”¨ã€‚æ¡†æ¶åç§° "Eino" æºè‡ªèŠ¬å…°è¯­ï¼Œæ„ä¸º"å”¯ä¸€çš„"ï¼Œä½“ç°äº†å…¶åœ¨ Go ç”Ÿæ€ä¸­ç‹¬ç‰¹çš„å®šä½ã€‚

### 2.1.1 Eino æ ¸å¿ƒè®¾è®¡ç†å¿µ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Eino è®¾è®¡ç†å¿µ                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚  ç»„ä»¶åŒ–è®¾è®¡  â”‚  â”‚  å›¾ç¼–æ’å¼•æ“  â”‚  â”‚  ç±»å‹å®‰å…¨   â”‚             â”‚
â”‚  â”‚             â”‚  â”‚             â”‚  â”‚             â”‚             â”‚
â”‚  â”‚ æ ‡å‡†åŒ–æ¥å£   â”‚  â”‚  DAG æ‰§è¡Œ   â”‚  â”‚  æ³›å‹æ”¯æŒ   â”‚             â”‚
â”‚  â”‚ å¯æ’æ‹”ç»„ä»¶   â”‚  â”‚  å¹¶è¡Œå¤„ç†   â”‚  â”‚  ç¼–è¯‘æ£€æŸ¥   â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚  æµå¼å¤„ç†   â”‚  â”‚  å›è°ƒæœºåˆ¶   â”‚  â”‚  æ‰©å±•ç”Ÿæ€   â”‚             â”‚
â”‚  â”‚             â”‚  â”‚             â”‚  â”‚             â”‚             â”‚
â”‚  â”‚ Stream API  â”‚  â”‚ Callbacks   â”‚  â”‚ eino-ext    â”‚             â”‚
â”‚  â”‚ å®æ—¶å“åº”    â”‚  â”‚ å¯è§‚æµ‹æ€§    â”‚  â”‚ ä¸°å¯Œç»„ä»¶    â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.1.2 Eino ä¸å…¶ä»–æ¡†æ¶å¯¹æ¯”

| ç‰¹æ€§ | Eino (Go) | LangChain (Python) | LlamaIndex (Python) |
|------|-----------|-------------------|---------------------|
| è¯­è¨€ | Go | Python | Python |
| ç±»å‹å®‰å…¨ | âœ… å¼ºç±»å‹ + æ³›å‹ | âŒ åŠ¨æ€ç±»å‹ | âŒ åŠ¨æ€ç±»å‹ |
| æ€§èƒ½ | âœ… é«˜æ€§èƒ½ | âš ï¸ ä¸­ç­‰ | âš ï¸ ä¸­ç­‰ |
| å¹¶å‘æ¨¡å‹ | âœ… Goroutine | âš ï¸ asyncio | âš ï¸ asyncio |
| ç¼–æ’æ–¹å¼ | Graph DAG | Chain/Agent | Pipeline |
| ç”Ÿæ€æˆç†Ÿåº¦ | âš ï¸ å‘å±•ä¸­ | âœ… æˆç†Ÿ | âœ… æˆç†Ÿ |

## 2.2 Eino æ ¸å¿ƒæ¨¡å—æ¶æ„

### 2.2.1 æ¨¡å—å±‚æ¬¡ç»“æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         åº”ç”¨å±‚ (Application)                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Sentinel / å…¶ä»–ä¸šåŠ¡åº”ç”¨                                â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                         ADK å±‚ (Agent Development Kit)              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚    Runner    â”‚  â”‚   prebuilt   â”‚  â”‚   Message    â”‚              â”‚
â”‚  â”‚   æ‰§è¡Œå™¨     â”‚  â”‚  é¢„ç½®Agent   â”‚  â”‚   æ¶ˆæ¯å¤„ç†   â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                         Flow å±‚ (Agent Patterns)                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚    ReAct     â”‚  â”‚ PlanExecute  â”‚  â”‚   Custom     â”‚              â”‚
â”‚  â”‚   æ¨ç†è¡ŒåŠ¨   â”‚  â”‚  è®¡åˆ’æ‰§è¡Œ    â”‚  â”‚   è‡ªå®šä¹‰     â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                         Compose å±‚ (Graph Orchestration)            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚    Graph     â”‚  â”‚    Chain     â”‚  â”‚   Runnable   â”‚              â”‚
â”‚  â”‚   å›¾ç¼–æ’     â”‚  â”‚   é“¾å¼è°ƒç”¨   â”‚  â”‚   å¯æ‰§è¡Œä½“   â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                         Components å±‚ (Core Components)             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚ Model  â”‚ â”‚Embeddingâ”‚ â”‚Retrieverâ”‚ â”‚Indexer â”‚ â”‚  Tool  â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚  â”‚ Prompt â”‚ â”‚ Loader â”‚ â”‚Transformerâ”‚ â”‚Documentâ”‚                     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                         Schema å±‚ (Data Structures)                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚   Message    â”‚  â”‚   ToolInfo   â”‚  â”‚   Document   â”‚              â”‚
â”‚  â”‚   æ¶ˆæ¯ç»“æ„   â”‚  â”‚   å·¥å…·ä¿¡æ¯   â”‚  â”‚   æ–‡æ¡£ç»“æ„   â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2.2 æ ¸å¿ƒåŒ…å¯¼å…¥è¯´æ˜

åœ¨ Sentinel é¡¹ç›®ä¸­ï¼Œä¸»è¦ä½¿ç”¨ä»¥ä¸‹ Eino åŒ…ï¼š

```go
// æ ¸å¿ƒç¼–æ’åŒ…
import "github.com/cloudwego/eino/compose"      // å›¾ç¼–æ’å¼•æ“

// æ•°æ®ç»“æ„åŒ…
import "github.com/cloudwego/eino/schema"       // æ¶ˆæ¯ã€å·¥å…·ç­‰æ•°æ®ç»“æ„

// ç»„ä»¶æ¥å£åŒ…
import "github.com/cloudwego/eino/components/model"      // æ¨¡å‹æ¥å£
import "github.com/cloudwego/eino/components/embedding"  // Embedding æ¥å£
import "github.com/cloudwego/eino/components/retriever"  // æ£€ç´¢å™¨æ¥å£
import "github.com/cloudwego/eino/components/indexer"    // ç´¢å¼•å™¨æ¥å£
import "github.com/cloudwego/eino/components/tool"       // å·¥å…·æ¥å£
import "github.com/cloudwego/eino/components/prompt"     // æç¤ºè¯æ¨¡æ¿
import "github.com/cloudwego/eino/components/document"   // æ–‡æ¡£å¤„ç†

// å›è°ƒæœºåˆ¶
import "github.com/cloudwego/eino/callbacks"    // å›è°ƒå¤„ç†å™¨

// Agent æ¨¡å¼
import "github.com/cloudwego/eino/flow/agent/react"  // ReAct Agent

// ADK (Agent Development Kit)
import "github.com/cloudwego/eino/adk"                    // ADK æ ¸å¿ƒ
import "github.com/cloudwego/eino/adk/prebuilt/planexecute"  // é¢„ç½® Agent
```

## 2.3 compose åŒ…ï¼šå›¾ç¼–æ’å¼•æ“

### 2.3.1 Graph æ ¸å¿ƒæ¦‚å¿µ

`compose.Graph` æ˜¯ Eino æ¡†æ¶çš„æ ¸å¿ƒç¼–æ’å¼•æ“ï¼Œé‡‡ç”¨æœ‰å‘æ— ç¯å›¾ï¼ˆDAGï¼‰æ¨¡å¼ç»„ç»‡å¤„ç†æµç¨‹ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Graph æ ¸å¿ƒæ¦‚å¿µ                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚   Node (èŠ‚ç‚¹)           Edge (è¾¹)           Runnable        â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚   â”‚ Lambda  â”‚                              â”‚ Invoke  â”‚     â”‚
â”‚   â”‚ Model   â”‚          æ•°æ®æµå‘             â”‚ Stream  â”‚     â”‚
â”‚   â”‚Retrieverâ”‚                              â”‚ Collect â”‚     â”‚
â”‚   â”‚ Indexer â”‚                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚   â”‚Template â”‚                                              â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                              â”‚
â”‚                                                             â”‚
â”‚   ç‰¹æ®ŠèŠ‚ç‚¹:                                                  â”‚
â”‚   â€¢ compose.START  - å›¾çš„èµ·å§‹ç‚¹                             â”‚
â”‚   â€¢ compose.END    - å›¾çš„ç»ˆæ­¢ç‚¹                             â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.3.2 Graph åˆ›å»ºä¸ç¼–è¯‘

**æ–‡ä»¶ä½ç½®**: `internal/ai/agent/chat_pipeline/orchestration.go:10-49`

```go
// åˆ›å»ºæ³›å‹ Graphï¼ŒæŒ‡å®šè¾“å…¥è¾“å‡ºç±»å‹
// è¾“å…¥: *UserMessage  è¾“å‡º: *schema.Message
g := compose.NewGraph[*UserMessage, *schema.Message]()

// æ·»åŠ å„ç±»èŠ‚ç‚¹
_ = g.AddLambdaNode(nodeName, lambdaFunc, options...)      // Lambda èŠ‚ç‚¹
_ = g.AddChatTemplateNode(nodeName, template)              // æ¨¡æ¿èŠ‚ç‚¹
_ = g.AddRetrieverNode(nodeName, retriever, options...)    // æ£€ç´¢èŠ‚ç‚¹

// è¿æ¥èŠ‚ç‚¹ï¼ˆå®šä¹‰æ•°æ®æµå‘ï¼‰
_ = g.AddEdge(compose.START, "NodeA")   // ä»èµ·ç‚¹åˆ° NodeA
_ = g.AddEdge("NodeA", "NodeB")         // NodeA åˆ° NodeB
_ = g.AddEdge("NodeB", compose.END)     // NodeB åˆ°ç»ˆç‚¹

// ç¼–è¯‘å›¾ï¼Œç”Ÿæˆå¯æ‰§è¡Œçš„ Runnable
r, err := g.Compile(ctx,
    compose.WithGraphName("ChatAgent"),
    compose.WithNodeTriggerMode(compose.AllPredecessor),
)
```

### 2.3.3 èŠ‚ç‚¹ç±»å‹è¯¦è§£

Eino æ”¯æŒå¤šç§èŠ‚ç‚¹ç±»å‹ï¼Œæ¯ç§ç±»å‹å¯¹åº”ä¸åŒçš„å¤„ç†é€»è¾‘ï¼š

| èŠ‚ç‚¹ç±»å‹ | æ·»åŠ æ–¹æ³• | ç”¨é€” | é¡¹ç›®ä¸­ä½¿ç”¨ |
|---------|---------|------|-----------|
| Lambda | `AddLambdaNode` | è‡ªå®šä¹‰å¤„ç†é€»è¾‘ | InputToRag, ReactAgent |
| ChatTemplate | `AddChatTemplateNode` | æç¤ºè¯æ¨¡æ¿ | ChatTemplate |
| Retriever | `AddRetrieverNode` | å‘é‡æ£€ç´¢ | MilvusRetriever |
| Indexer | `AddIndexerNode` | å‘é‡ç´¢å¼• | MilvusIndexer |
| Loader | `AddLoaderNode` | æ–‡æ¡£åŠ è½½ | FileLoader |
| Transformer | `AddDocumentTransformerNode` | æ–‡æ¡£è½¬æ¢ | MarkdownSplitter |

### 2.3.4 èŠ‚ç‚¹è§¦å‘æ¨¡å¼

```go
// ç¼–è¯‘é€‰é¡¹ï¼šèŠ‚ç‚¹è§¦å‘æ¨¡å¼
compose.WithNodeTriggerMode(compose.AllPredecessor)  // ç­‰å¾…æ‰€æœ‰å‰ç½®èŠ‚ç‚¹å®Œæˆ
compose.WithNodeTriggerMode(compose.AnyPredecessor)  // ä»»ä¸€å‰ç½®èŠ‚ç‚¹å®Œæˆå³è§¦å‘
```

```
AllPredecessor æ¨¡å¼:                    AnyPredecessor æ¨¡å¼:

    A â”€â”€â”                                   A â”€â”€â”
        â”œâ”€â”€â–¶ C (ç­‰å¾… A å’Œ B)                    â”œâ”€â”€â–¶ C (A æˆ– B å®Œæˆå³è§¦å‘)
    B â”€â”€â”˜                                   B â”€â”€â”˜
```

## 2.4 schema åŒ…ï¼šæ ¸å¿ƒæ•°æ®ç»“æ„

### 2.4.1 Message æ¶ˆæ¯ç»“æ„

`schema.Message` æ˜¯ Eino ä¸­æœ€æ ¸å¿ƒçš„æ•°æ®ç»“æ„ï¼Œç”¨äºè¡¨ç¤ºå¯¹è¯æ¶ˆæ¯ã€‚

**æ–‡ä»¶ä½ç½®**: `internal/ai/agent/chat_pipeline/types.go:1-9`

```go
package chat_pipeline

import "github.com/cloudwego/eino/schema"

type UserMessage struct {
    ID      string            `json:"id"`
    Query   string            `json:"query"`
    History []*schema.Message `json:"history"`  // å†å²æ¶ˆæ¯åˆ—è¡¨
}
```

### 2.4.2 Message ç±»å‹å·¥å‚æ–¹æ³•

```go
// åˆ›å»ºä¸åŒè§’è‰²çš„æ¶ˆæ¯
schema.UserMessage("ç”¨æˆ·è¾“å…¥å†…å®¹")      // ç”¨æˆ·æ¶ˆæ¯
schema.SystemMessage("ç³»ç»Ÿæç¤ºå†…å®¹")    // ç³»ç»Ÿæ¶ˆæ¯
schema.AssistantMessage("åŠ©æ‰‹å›å¤")     // åŠ©æ‰‹æ¶ˆæ¯
```

### 2.4.3 ToolInfo å·¥å…·ä¿¡æ¯ç»“æ„

**æ–‡ä»¶ä½ç½®**: `internal/ai/tools/query_events.go:19-29`

```go
func (t *EventQueryTool) Info(ctx context.Context) (*schema.ToolInfo, error) {
    return &schema.ToolInfo{
        Name: "query_events",
        Desc: "æŸ¥è¯¢å®‰å…¨äº‹ä»¶åˆ—è¡¨ï¼ŒåŒ…æ‹¬æ¼æ´ã€å¨èƒæƒ…æŠ¥ç­‰å®‰å…¨äº‹ä»¶",
        ParamsOneOf: schema.NewParamsOneOfByParams(map[string]*schema.ParameterInfo{
            "severity": {Type: schema.String, Desc: "æŒ‰ä¸¥é‡ç¨‹åº¦ç­›é€‰"},
            "status":   {Type: schema.String, Desc: "æŒ‰çŠ¶æ€ç­›é€‰"},
            "limit":    {Type: schema.Integer, Desc: "è¿”å›æ•°é‡é™åˆ¶"},
        }),
    }, nil
}
```

## 2.5 callbacks åŒ…ï¼šå›è°ƒæœºåˆ¶

### 2.5.1 å›è°ƒå¤„ç†å™¨

**æ–‡ä»¶ä½ç½®**: `utility/log_call_back/log_call_back.go:1-42`

```go
package log_call_back

import (
    "context"
    "encoding/json"
    "fmt"
    "github.com/cloudwego/eino/callbacks"
)

func LogCallback(config *LogCallbackConfig) callbacks.Handler {
    builder := callbacks.NewHandlerBuilder()

    // èŠ‚ç‚¹å¼€å§‹æ—¶è§¦å‘
    builder.OnStartFn(func(ctx context.Context, info *callbacks.RunInfo,
        input callbacks.CallbackInput) context.Context {
        fmt.Printf("[view start]:[%s:%s:%s]\n",
            info.Component, info.Type, info.Name)
        return ctx
    })

    // èŠ‚ç‚¹ç»“æŸæ—¶è§¦å‘
    builder.OnEndFn(func(ctx context.Context, info *callbacks.RunInfo,
        output callbacks.CallbackOutput) context.Context {
        fmt.Printf("[view end]:[%s:%s:%s]\n",
            info.Component, info.Type, info.Name)
        return ctx
    })

    return builder.Build()
}
```

---

# ç¬¬ä¸‰ç«  èŠå¤© Agent æµæ°´çº¿è¯¦è§£

## 3.1 Chat Pipeline æ¦‚è¿°

Chat Pipeline æ˜¯ Sentinel çš„æ ¸å¿ƒå¯¹è¯å¤„ç†æµæ°´çº¿ï¼Œä½œä¸º Supervisor æ¶æ„ä¸‹ ChatAgent çš„å†…éƒ¨å®ç°ã€‚åŸºäº Eino çš„ Graph ç¼–æ’å®ç°äº† RAGï¼ˆæ£€ç´¢å¢å¼ºç”Ÿæˆï¼‰+ ReAct Agent çš„æ··åˆæ¶æ„ã€‚åŒæ ·çš„ Pipeline æ¨¡å¼ä¹Ÿè¢« EventAgentã€ReportAgentã€RiskAgent å¤ç”¨ï¼ŒåŒºåˆ«åœ¨äºå„è‡ªçš„ç³»ç»Ÿ Prompt å’Œå·¥å…·é›†ã€‚

### 3.1.1 æµæ°´çº¿æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Chat Pipeline æ¶æ„                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚   è¾“å…¥: UserMessage                                                      â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚  { ID: "xxx", Query: "ç”¨æˆ·é—®é¢˜", History: [...] }                â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                    â”‚                                    â”‚
â”‚                                    â–¼                                    â”‚
â”‚                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚
â”‚                            â”‚    START     â”‚                             â”‚
â”‚                            â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚
â”‚                                   â”‚                                     â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚                    â”‚                             â”‚                      â”‚
â”‚                    â–¼                             â–¼                      â”‚
â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚           â”‚  InputToRag  â”‚              â”‚ InputToChat  â”‚                â”‚
â”‚           â”‚  æå–Query   â”‚              â”‚ æ„å»ºä¸Šä¸‹æ–‡   â”‚                â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                  â”‚                             â”‚                        â”‚
â”‚                  â–¼                             â”‚                        â”‚
â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚                        â”‚
â”‚           â”‚MilvusRetrieverâ”‚                    â”‚                        â”‚
â”‚           â”‚  å‘é‡æ£€ç´¢     â”‚                    â”‚                        â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚                        â”‚
â”‚                  â”‚                             â”‚                        â”‚
â”‚                  â”‚  documents                  â”‚  content, history      â”‚
â”‚                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â”‚                                 â”‚                                       â”‚
â”‚                                 â–¼                                       â”‚
â”‚                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚
â”‚                         â”‚ ChatTemplate â”‚                                â”‚
â”‚                         â”‚  æç¤ºè¯æ¨¡æ¿   â”‚                                â”‚
â”‚                         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                                â”‚
â”‚                                â”‚                                        â”‚
â”‚                                â–¼                                        â”‚
â”‚                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚
â”‚                         â”‚  ReactAgent  â”‚                                â”‚
â”‚                         â”‚  æ¨ç†+å·¥å…·   â”‚                                â”‚
â”‚                         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                                â”‚
â”‚                                â”‚                                        â”‚
â”‚                                â–¼                                        â”‚
â”‚                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚
â”‚                         â”‚     END      â”‚                                â”‚
â”‚                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                â”‚
â”‚                                â”‚                                        â”‚
â”‚   è¾“å‡º: *schema.Message                                                  â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚  { Role: "assistant", Content: "AIå›å¤å†…å®¹" }                    â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 3.2 Graph ç¼–æ’å®ç°

### 3.2.1 å®Œæ•´ç¼–æ’ä»£ç 

**æ–‡ä»¶ä½ç½®**: `internal/ai/agent/chat_pipeline/orchestration.go`

```go
package chat_pipeline

import (
    "context"
    "github.com/cloudwego/eino/compose"
    "github.com/cloudwego/eino/schema"
)

func BuildChatAgent(ctx context.Context) (r compose.Runnable[*UserMessage, *schema.Message], err error) {
    // å®šä¹‰èŠ‚ç‚¹åç§°å¸¸é‡
    const (
        InputToRag      = "InputToRag"
        ChatTemplate    = "ChatTemplate"
        ReactAgent      = "ReactAgent"
        MilvusRetriever = "MilvusRetriever"
        InputToChat     = "InputToChat"
    )

    // åˆ›å»º Graphï¼ŒæŒ‡å®šè¾“å…¥è¾“å‡ºç±»å‹
    g := compose.NewGraph[*UserMessage, *schema.Message]()

    // æ·»åŠ  InputToRag èŠ‚ç‚¹ï¼šæå–ç”¨æˆ·æŸ¥è¯¢ç”¨äº RAG æ£€ç´¢
    _ = g.AddLambdaNode(InputToRag,
        compose.InvokableLambdaWithOption(newInputToRagLambda),
        compose.WithNodeName("UserMessageToRag"))

    // æ·»åŠ  ChatTemplate èŠ‚ç‚¹ï¼šæç¤ºè¯æ¨¡æ¿
    chatTemplateKeyOfChatTemplate, err := newChatTemplate(ctx)
    if err != nil {
        return nil, err
    }
    _ = g.AddChatTemplateNode(ChatTemplate, chatTemplateKeyOfChatTemplate)

    // æ·»åŠ  ReactAgent èŠ‚ç‚¹ï¼šReAct æ¨ç†å¼•æ“
    reactAgentKeyOfLambda, err := newReactAgentLambda(ctx)
    if err != nil {
        return nil, err
    }
    _ = g.AddLambdaNode(ReactAgent, reactAgentKeyOfLambda,
        compose.WithNodeName("ReActAgent"))

    // æ·»åŠ  MilvusRetriever èŠ‚ç‚¹ï¼šå‘é‡æ£€ç´¢
    milvusRetrieverKeyOfRetriever, err := newRetriever(ctx)
    if err != nil {
        return nil, err
    }
    // è®¾ç½®è¾“å‡º key ä¸º "documents"ï¼ŒåŒ¹é… ChatTemplate çš„å ä½ç¬¦
    _ = g.AddRetrieverNode(MilvusRetriever, milvusRetrieverKeyOfRetriever,
        compose.WithOutputKey("documents"))

    // æ·»åŠ  InputToChat èŠ‚ç‚¹ï¼šæ„å»ºå¯¹è¯ä¸Šä¸‹æ–‡
    _ = g.AddLambdaNode(InputToChat,
        compose.InvokableLambdaWithOption(newInputToChatLambda),
        compose.WithNodeName("UserMessageToChat"))

    // å®šä¹‰è¾¹ï¼ˆæ•°æ®æµå‘ï¼‰
    _ = g.AddEdge(compose.START, InputToRag)      // START -> InputToRag
    _ = g.AddEdge(compose.START, InputToChat)     // START -> InputToChat (å¹¶è¡Œ)
    _ = g.AddEdge(ReactAgent, compose.END)        // ReactAgent -> END
    _ = g.AddEdge(InputToRag, MilvusRetriever)    // InputToRag -> MilvusRetriever
    _ = g.AddEdge(MilvusRetriever, ChatTemplate)  // MilvusRetriever -> ChatTemplate
    _ = g.AddEdge(InputToChat, ChatTemplate)      // InputToChat -> ChatTemplate
    _ = g.AddEdge(ChatTemplate, ReactAgent)       // ChatTemplate -> ReactAgent

    // ç¼–è¯‘ Graph
    r, err = g.Compile(ctx,
        compose.WithGraphName("ChatAgent"),
        compose.WithNodeTriggerMode(compose.AllPredecessor))
    if err != nil {
        return nil, err
    }
    return r, err
}
```

### 3.2.2 æ•°æ®æµå‘åˆ†æ

```
æ•°æ®æµå‘è¯¦è§£:

1. å¹¶è¡Œåˆ†æ”¯ (ä» START å¼€å§‹)
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  START                                                      â”‚
   â”‚    â”‚                                                        â”‚
   â”‚    â”œâ”€â”€â–¶ InputToRag â”€â”€â–¶ MilvusRetriever â”€â”€â”                 â”‚
   â”‚    â”‚    (æå–Query)    (å‘é‡æ£€ç´¢)         â”‚                 â”‚
   â”‚    â”‚                                      â–¼                 â”‚
   â”‚    â”‚                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
   â”‚    â””â”€â”€â–¶ InputToChat â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ ChatTemplate â”‚          â”‚
   â”‚         (æ„å»ºä¸Šä¸‹æ–‡)               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

2. æ•°æ®åˆå¹¶ (ChatTemplate èŠ‚ç‚¹)
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  ChatTemplate æ¥æ”¶çš„æ•°æ®:                                    â”‚
   â”‚  â€¢ documents  â† MilvusRetriever è¾“å‡º (æ£€ç´¢åˆ°çš„æ–‡æ¡£)          â”‚
   â”‚  â€¢ content    â† InputToChat è¾“å‡º (ç”¨æˆ·é—®é¢˜)                  â”‚
   â”‚  â€¢ history    â† InputToChat è¾“å‡º (å¯¹è¯å†å²)                  â”‚
   â”‚  â€¢ date       â† InputToChat è¾“å‡º (å½“å‰æ—¶é—´)                  â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 3.3 Lambda èŠ‚ç‚¹å®ç°

### 3.3.1 InputToRag Lambda

**æ–‡ä»¶ä½ç½®**: `internal/ai/agent/chat_pipeline/lambda_func.go:8-11`

```go
// ä» UserMessage ä¸­æå– Query ç”¨äºå‘é‡æ£€ç´¢
func newInputToRagLambda(ctx context.Context, input *UserMessage, opts ...any) (output string, err error) {
    return input.Query, nil
}
```

### 3.3.2 InputToChat Lambda

**æ–‡ä»¶ä½ç½®**: `internal/ai/agent/chat_pipeline/lambda_func.go:13-20`

```go
// æ„å»ºå¯¹è¯ä¸Šä¸‹æ–‡ï¼ŒåŒ…å«ç”¨æˆ·é—®é¢˜ã€å†å²è®°å½•å’Œå½“å‰æ—¶é—´
func newInputToChatLambda(ctx context.Context, input *UserMessage, opts ...any) (output map[string]any, err error) {
    return map[string]any{
        "content": input.Query,           // ç”¨æˆ·å½“å‰é—®é¢˜
        "history": input.History,         // å¯¹è¯å†å²
        "date":    time.Now().Format("2006-01-02 15:04:05"),  // å½“å‰æ—¶é—´
    }, nil
}
```

## 3.4 Retriever èŠ‚ç‚¹å®ç°

### 3.4.1 Milvus æ£€ç´¢å™¨é…ç½®

**æ–‡ä»¶ä½ç½®**: `internal/ai/retriever/retriever.go:1-35`

```go
package retriever

import (
    "Sentinel/internal/ai/embedder"
    "Sentinel/utility/client"
    "Sentinel/utility/common"
    "context"

    "github.com/cloudwego/eino-ext/components/retriever/milvus"
    "github.com/cloudwego/eino/components/retriever"
    "github.com/milvus-io/milvus-sdk-go/v2/entity"
)

func NewMilvusRetriever(ctx context.Context) (rtr retriever.Retriever, err error) {
    // åˆ›å»º Milvus å®¢æˆ·ç«¯
    cli, err := client.NewMilvusClient(ctx)
    if err != nil {
        return nil, err
    }

    // åˆ›å»º Embedding ç»„ä»¶
    eb, err := embedder.DoubaoEmbedding(ctx)
    if err != nil {
        return nil, err
    }

    // é…ç½® Milvus Retriever
    r, err := milvus.NewRetriever(ctx, &milvus.RetrieverConfig{
        Client:      cli,                        // Milvus å®¢æˆ·ç«¯
        Collection:  common.MilvusCollectionName, // é›†åˆåç§°
        VectorField: "vector",                   // å‘é‡å­—æ®µå
        TopK:        1,                          // è¿”å›æœ€ç›¸ä¼¼çš„ 1 æ¡
        Embedding:   eb,                         // Embedding ç»„ä»¶
        MetricType:  entity.L2,                  // è·ç¦»åº¦é‡ï¼šL2 æ¬§æ°è·ç¦»
    })
    if err != nil {
        return nil, err
    }
    return r, nil
}
```

### 3.4.2 æ£€ç´¢æµç¨‹å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Retriever æ£€ç´¢æµç¨‹                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚   ç”¨æˆ·æŸ¥è¯¢ (Query)                                          â”‚
â”‚        â”‚                                                    â”‚
â”‚        â–¼                                                    â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                          â”‚
â”‚   â”‚  Embedding   â”‚  å°†æŸ¥è¯¢æ–‡æœ¬è½¬æ¢ä¸ºå‘é‡                     â”‚
â”‚   â”‚  (è±†åŒ… ARK)  â”‚                                          â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                                          â”‚
â”‚          â”‚                                                  â”‚
â”‚          â–¼                                                  â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                          â”‚
â”‚   â”‚   Milvus     â”‚  å‘é‡ç›¸ä¼¼åº¦æœç´¢                          â”‚
â”‚   â”‚  å‘é‡æ£€ç´¢    â”‚  TopK=1, MetricType=L2                   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                                          â”‚
â”‚          â”‚                                                  â”‚
â”‚          â–¼                                                  â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                          â”‚
â”‚   â”‚  Documents   â”‚  è¿”å›æœ€ç›¸ä¼¼çš„æ–‡æ¡£åˆ—è¡¨                     â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                          â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 3.5 ReAct Agent å®ç°

ReAct (Reasoning + Acting) æ˜¯ä¸€ç§è®© LLM äº¤æ›¿è¿›è¡Œæ¨ç†å’Œè¡ŒåŠ¨çš„ Agent æ¨¡å¼ã€‚

### 3.5.1 ReAct å·¥ä½œåŸç†

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ReAct Agent å·¥ä½œå¾ªç¯                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚                    æ¨ç†å¾ªç¯                              â”‚   â”‚
â”‚   â”‚                                                         â”‚   â”‚
â”‚   â”‚   1. Thought (æ€è€ƒ)                                     â”‚   â”‚
â”‚   â”‚      â”‚  åˆ†æå½“å‰çŠ¶æ€ï¼Œå†³å®šä¸‹ä¸€æ­¥è¡ŒåŠ¨                     â”‚   â”‚
â”‚   â”‚      â–¼                                                  â”‚   â”‚
â”‚   â”‚   2. Action (è¡ŒåŠ¨)                                      â”‚   â”‚
â”‚   â”‚      â”‚  é€‰æ‹©å¹¶è°ƒç”¨å·¥å…·                                   â”‚   â”‚
â”‚   â”‚      â–¼                                                  â”‚   â”‚
â”‚   â”‚   3. Observation (è§‚å¯Ÿ)                                 â”‚   â”‚
â”‚   â”‚      â”‚  è·å–å·¥å…·æ‰§è¡Œç»“æœ                                 â”‚   â”‚
â”‚   â”‚      â–¼                                                  â”‚   â”‚
â”‚   â”‚   4. åˆ¤æ–­æ˜¯å¦éœ€è¦ç»§ç»­                                    â”‚   â”‚
â”‚   â”‚      â”‚                                                  â”‚   â”‚
â”‚   â”‚      â”œâ”€â”€â–¶ æ˜¯ â”€â”€â–¶ è¿”å›æ­¥éª¤ 1                             â”‚   â”‚
â”‚   â”‚      â”‚                                                  â”‚   â”‚
â”‚   â”‚      â””â”€â”€â–¶ å¦ â”€â”€â–¶ ç”Ÿæˆæœ€ç»ˆå›å¤                           â”‚   â”‚
â”‚   â”‚                                                         â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.5.2 ReAct Agent é…ç½®ä»£ç 

åŸºäº Eino æ¡†æ¶çš„ ReAct Agent å®ç°ï¼š

```go
import (
    "github.com/cloudwego/eino/compose"
    "github.com/cloudwego/eino/flow/agent/react"
)

func newReactAgentLambda(ctx context.Context) (lba *compose.Lambda, err error) {
    config := &react.AgentConfig{
        MaxStep:            25,                    // æœ€å¤§æ¨ç†æ­¥æ•°
        ToolReturnDirectly: map[string]struct{}{}, // ç›´æ¥è¿”å›çš„å·¥å…·
    }

    // è®¾ç½®å·¥å…·è°ƒç”¨æ¨¡å‹
    chatModelIns, err := newChatModel(ctx)
    if err != nil {
        return nil, err
    }
    config.ToolCallingModel = chatModelIns

    // æ³¨å†Œå·¥å…·
    config.ToolsConfig.Tools = append(config.ToolsConfig.Tools,
        tools.NewPrometheusAlertsQueryTool(),  // Prometheus å‘Šè­¦æŸ¥è¯¢
        tools.NewMysqlCrudTool(),              // MySQL æ•°æ®åº“æ“ä½œ
        tools.NewGetCurrentTimeTool(),         // è·å–å½“å‰æ—¶é—´
        tools.NewQueryInternalDocsTool(),      // å†…éƒ¨æ–‡æ¡£æŸ¥è¯¢
    )

    // åˆ›å»º ReAct Agent å¹¶åŒ…è£…ä¸º Lambda
    ins, err := react.NewAgent(ctx, config)
    lba, err = compose.AnyLambda(ins.Generate, ins.Stream, nil, nil)
    return lba, nil
}
```

---

# ç¬¬å››ç«  çŸ¥è¯†åº“ç´¢å¼•æµæ°´çº¿è¯¦è§£

## 4.1 Knowledge Index Pipeline æ¦‚è¿°

çŸ¥è¯†åº“ç´¢å¼•æµæ°´çº¿è´Ÿè´£å°†æ–‡æ¡£è½¬æ¢ä¸ºå‘é‡å¹¶å­˜å‚¨åˆ° Milvusï¼Œä¸º RAG æ£€ç´¢æä¾›æ•°æ®åŸºç¡€ã€‚

### 4.1.1 æµæ°´çº¿æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Knowledge Index Pipeline æ¶æ„                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚   è¾“å…¥: document.Source (æ–‡ä»¶è·¯å¾„)                           â”‚
â”‚        â”‚                                                    â”‚
â”‚        â–¼                                                    â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                          â”‚
â”‚   â”‚  FileLoader  â”‚  åŠ è½½æ–‡ä»¶å†…å®¹                             â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                                          â”‚
â”‚          â”‚                                                  â”‚
â”‚          â–¼                                                  â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                          â”‚
â”‚   â”‚  Markdown    â”‚  æŒ‰æ ‡é¢˜åˆ†å‰²æ–‡æ¡£                           â”‚
â”‚   â”‚  Splitter    â”‚                                          â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                                          â”‚
â”‚          â”‚                                                  â”‚
â”‚          â–¼                                                  â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                          â”‚
â”‚   â”‚   Milvus     â”‚  å‘é‡åŒ–å¹¶å­˜å‚¨                             â”‚
â”‚   â”‚   Indexer    â”‚                                          â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                                          â”‚
â”‚          â”‚                                                  â”‚
â”‚          â–¼                                                  â”‚
â”‚   è¾“å‡º: []string (æ–‡æ¡£ ID åˆ—è¡¨)                              â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 4.2 Graph ç¼–æ’å®ç°

**æ–‡ä»¶ä½ç½®**: `internal/ai/agent/knowledge_index_pipeline/orchestration.go`

```go
package knowledge_index_pipeline

import (
    "context"
    "github.com/cloudwego/eino/components/document"
    "github.com/cloudwego/eino/compose"
)

func BuildKnowledgeIndexing(ctx context.Context) (r compose.Runnable[document.Source, []string], err error) {
    const (
        FileLoader       = "FileLoader"
        MarkdownSplitter = "MarkdownSplitter"
        MilvusIndexer    = "MilvusIndexer"
    )

    // åˆ›å»º Graph
    g := compose.NewGraph[document.Source, []string]()

    // æ·»åŠ æ–‡ä»¶åŠ è½½èŠ‚ç‚¹
    fileLoaderKeyOfLoader, err := newLoader(ctx)
    if err != nil {
        return nil, err
    }
    _ = g.AddLoaderNode(FileLoader, fileLoaderKeyOfLoader)

    // æ·»åŠ  Markdown åˆ†å‰²èŠ‚ç‚¹
    markdownSplitterKeyOfDocumentTransformer, err := newDocumentTransformer(ctx)
    if err != nil {
        return nil, err
    }
    _ = g.AddDocumentTransformerNode(MarkdownSplitter, markdownSplitterKeyOfDocumentTransformer)

    // æ·»åŠ  Milvus ç´¢å¼•èŠ‚ç‚¹
    milvusIndexerKeyOfIndexer, err := newIndexer(ctx)
    if err != nil {
        return nil, err
    }
    _ = g.AddIndexerNode(MilvusIndexer, milvusIndexerKeyOfIndexer)

    // å®šä¹‰è¾¹
    _ = g.AddEdge(compose.START, FileLoader)
    _ = g.AddEdge(FileLoader, MarkdownSplitter)
    _ = g.AddEdge(MarkdownSplitter, MilvusIndexer)
    _ = g.AddEdge(MilvusIndexer, compose.END)

    // ç¼–è¯‘
    r, err = g.Compile(ctx,
        compose.WithGraphName("KnowledgeIndexing"),
        compose.WithNodeTriggerMode(compose.AnyPredecessor))
    return r, err
}
```

## 4.3 FileLoader ç»„ä»¶

**æ–‡ä»¶ä½ç½®**: `internal/ai/agent/knowledge_index_pipeline/loader.go`

```go
package knowledge_index_pipeline

import (
    "context"
    "github.com/cloudwego/eino-ext/components/document/loader/file"
    "github.com/cloudwego/eino/components/document"
)

func newLoader(ctx context.Context) (ldr document.Loader, err error) {
    config := &file.FileLoaderConfig{}
    ldr, err = file.NewFileLoader(ctx, config)
    if err != nil {
        return nil, err
    }
    return ldr, nil
}
```

## 4.4 Markdown Splitter ç»„ä»¶

**æ–‡ä»¶ä½ç½®**: `internal/ai/agent/knowledge_index_pipeline/transformer.go`

```go
package knowledge_index_pipeline

import (
    "context"
    "github.com/cloudwego/eino-ext/components/document/transformer/splitter/markdown"
    "github.com/cloudwego/eino/components/document"
    "github.com/google/uuid"
)

func newDocumentTransformer(ctx context.Context) (tfr document.Transformer, err error) {
    config := &markdown.HeaderConfig{
        Headers: map[string]string{
            "#": "title",  // ä¸€çº§æ ‡é¢˜ä½œä¸ºåˆ†å‰²ç‚¹
        },
        TrimHeaders: false,
        IDGenerator: func(ctx context.Context, originalID string, splitIndex int) string {
            return uuid.New().String()  // ä¸ºæ¯ä¸ªåˆ†å‰²å—ç”Ÿæˆå”¯ä¸€ ID
        },
    }
    tfr, err = markdown.NewHeaderSplitter(ctx, config)
    return tfr, nil
}
```

## 4.5 Milvus Indexer ç»„ä»¶

**æ–‡ä»¶ä½ç½®**: `internal/ai/indexer/indexer.go`

```go
package indexer

import (
    embedder2 "Sentinel/internal/ai/embedder"
    "Sentinel/utility/client"
    "Sentinel/utility/common"
    "context"
    "github.com/cloudwego/eino-ext/components/indexer/milvus"
    "github.com/milvus-io/milvus-sdk-go/v2/entity"
)

func NewMilvusIndexer(ctx context.Context) (*milvus.Indexer, error) {
    cli, err := client.NewMilvusClient(ctx)
    if err != nil {
        return nil, err
    }
    eb, err := embedder2.DoubaoEmbedding(ctx)
    if err != nil {
        return nil, err
    }
    config := &milvus.IndexerConfig{
        Client:     cli,
        Collection: common.MilvusCollectionName,
        Fields:     fields,
        Embedding:  eb,
    }
    return milvus.NewIndexer(ctx, config)
}
```

---

# ç¬¬äº”ç«  Tool å·¥å…·ç³»ç»Ÿè¯¦è§£

## 5.1 Tool ç³»ç»Ÿæ¦‚è¿°

Eino çš„ Tool ç³»ç»Ÿå…è®¸ Agent è°ƒç”¨å¤–éƒ¨å·¥å…·æ¥å®Œæˆç‰¹å®šä»»åŠ¡ã€‚Sentinel å®ç°äº†å¤šç§ä¸šåŠ¡å·¥å…·ã€‚

### 5.1.1 å·¥å…·æ¸…å•

| å·¥å…·åç§° | æ–‡ä»¶ä½ç½® | åŠŸèƒ½æè¿° |
|---------|---------|---------|
| query_prometheus_alerts | `tools/query_metrics_alerts.go` | æŸ¥è¯¢ Prometheus å‘Šè­¦ |
| mysql_crud | `tools/mysql_crud.go` | MySQL æ•°æ®åº“æ“ä½œ |
| get_current_time | `tools/get_current_time.go` | è·å–å½“å‰æ—¶é—´ |
| query_internal_docs | `tools/query_internal_docs.go` | å†…éƒ¨æ–‡æ¡£æ£€ç´¢ |
| query_events | `tools/query_events.go` | å®‰å…¨äº‹ä»¶æŸ¥è¯¢ |
| query_subscriptions | `tools/query_subscriptions.go` | è®¢é˜…æºæŸ¥è¯¢ |
| query_reports | `tools/query_reports.go` | æŠ¥å‘ŠæŸ¥è¯¢ |
| MCP Tools | `tools/query_log.go` | MCP åè®®æ—¥å¿—å·¥å…· |

## 5.2 Tool å®ç°æ¨¡å¼

Eino æä¾›ä¸¤ç§ Tool å®ç°æ–¹å¼ï¼š

### 5.2.1 æ–¹å¼ä¸€ï¼šå®ç° BaseTool æ¥å£

**æ–‡ä»¶ä½ç½®**: `internal/ai/tools/query_events.go`

```go
package tools

import (
    "context"
    "encoding/json"
    "Sentinel/internal/database"
    "github.com/cloudwego/eino/components/tool"
    "github.com/cloudwego/eino/schema"
)

// å®šä¹‰å·¥å…·ç»“æ„ä½“
type EventQueryTool struct{}

// å·¥å‚å‡½æ•°
func NewEventQueryTool() tool.BaseTool {
    return &EventQueryTool{}
}

// å®ç° Info æ–¹æ³•ï¼šå®šä¹‰å·¥å…·å…ƒä¿¡æ¯
func (t *EventQueryTool) Info(ctx context.Context) (*schema.ToolInfo, error) {
    return &schema.ToolInfo{
        Name: "query_events",
        Desc: "æŸ¥è¯¢å®‰å…¨äº‹ä»¶åˆ—è¡¨ï¼ŒåŒ…æ‹¬æ¼æ´ã€å¨èƒæƒ…æŠ¥ç­‰å®‰å…¨äº‹ä»¶",
        ParamsOneOf: schema.NewParamsOneOfByParams(map[string]*schema.ParameterInfo{
            "severity": {Type: schema.String, Desc: "æŒ‰ä¸¥é‡ç¨‹åº¦ç­›é€‰"},
            "status":   {Type: schema.String, Desc: "æŒ‰çŠ¶æ€ç­›é€‰"},
            "limit":    {Type: schema.Integer, Desc: "è¿”å›æ•°é‡é™åˆ¶"},
        }),
    }, nil
}

// å®ç° InvokableRun æ–¹æ³•ï¼šæ‰§è¡Œå·¥å…·é€»è¾‘
func (t *EventQueryTool) InvokableRun(ctx context.Context, args string, opts ...tool.Option) (string, error) {
    var params struct {
        Severity string `json:"severity"`
        Status   string `json:"status"`
        Limit    int    `json:"limit"`
    }
    json.Unmarshal([]byte(args), &params)

    // æ‰§è¡Œæ•°æ®åº“æŸ¥è¯¢
    db := database.GetDB()
    query := db.Table("security_events").Limit(params.Limit)
    // ... æŸ¥è¯¢é€»è¾‘

    data, _ := json.Marshal(results)
    return string(data), nil
}
```

### 5.2.2 æ–¹å¼äºŒï¼šä½¿ç”¨ InferTool è‡ªåŠ¨æ¨æ–­

**æ–‡ä»¶ä½ç½®**: `internal/ai/tools/get_current_time.go`

```go
package tools

import (
    "context"
    "encoding/json"
    "time"
    "github.com/cloudwego/eino/components/tool"
    "github.com/cloudwego/eino/components/tool/utils"
)

// å®šä¹‰è¾“å…¥ç»“æ„ä½“ï¼ˆä½¿ç”¨ jsonschema æ ‡ç­¾è‡ªåŠ¨ç”Ÿæˆå‚æ•°æè¿°ï¼‰
type GetCurrentTimeInput struct{}

// å®šä¹‰è¾“å‡ºç»“æ„ä½“
type GetCurrentTimeOutput struct {
    Success      bool   `json:"success" jsonschema:"description=æ˜¯å¦æˆåŠŸ"`
    Seconds      int64  `json:"seconds" jsonschema:"description=Unixæ—¶é—´æˆ³(ç§’)"`
    Milliseconds int64  `json:"milliseconds" jsonschema:"description=Unixæ—¶é—´æˆ³(æ¯«ç§’)"`
    Timestamp    string `json:"timestamp" jsonschema:"description=å¯è¯»æ—¶é—´æ ¼å¼"`
}

func NewGetCurrentTimeTool() tool.InvokableTool {
    // ä½¿ç”¨ InferOptionableTool è‡ªåŠ¨æ¨æ–­å‚æ•°
    t, _ := utils.InferOptionableTool(
        "get_current_time",                    // å·¥å…·åç§°
        "è·å–å½“å‰ç³»ç»Ÿæ—¶é—´",                      // å·¥å…·æè¿°
        func(ctx context.Context, input *GetCurrentTimeInput, opts ...tool.Option) (string, error) {
            now := time.Now()
            output := GetCurrentTimeOutput{
                Success:      true,
                Seconds:      now.Unix(),
                Milliseconds: now.UnixMilli(),
                Timestamp:    now.Format("2006-01-02 15:04:05"),
            }
            jsonBytes, _ := json.MarshalIndent(output, "", "  ")
            return string(jsonBytes), nil
        })
    return t
}
```

## 5.3 MCP åè®®å·¥å…·é›†æˆ

**æ–‡ä»¶ä½ç½®**: `internal/ai/tools/query_log.go`

```go
package tools

import (
    "context"
    e_mcp "github.com/cloudwego/eino-ext/components/tool/mcp"
    "github.com/cloudwego/eino/components/tool"
    "github.com/mark3labs/mcp-go/client"
    "github.com/mark3labs/mcp-go/mcp"
)

func GetLogMcpTool() ([]tool.BaseTool, error) {
    mcp_url := "https://mcp-api.tencent-cloud.com/sse/xxx"
    ctx := context.Background()

    // åˆ›å»º SSE MCP å®¢æˆ·ç«¯
    cli, err := client.NewSSEMCPClient(mcp_url)
    if err != nil {
        return nil, err
    }

    // å¯åŠ¨å®¢æˆ·ç«¯
    cli.Start(ctx)

    // åˆå§‹åŒ– MCP åè®®
    initRequest := mcp.InitializeRequest{}
    initRequest.Params.ProtocolVersion = mcp.LATEST_PROTOCOL_VERSION
    cli.Initialize(ctx, initRequest)

    // è·å– MCP å·¥å…·åˆ—è¡¨
    mcpTools, _ := e_mcp.GetTools(ctx, &e_mcp.Config{Cli: cli})
    return mcpTools, nil
}
```

---

# ç¬¬å…­ç«  æ¨¡å‹ä¸ Embedding é›†æˆ

## 6.1 LLM æ¨¡å‹é…ç½®

**æ–‡ä»¶ä½ç½®**: `internal/ai/models/open_ai.go`

```go
package models

import (
    "context"
    "github.com/cloudwego/eino-ext/components/model/openai"
    "github.com/cloudwego/eino/components/model"
    "github.com/gogf/gf/v2/frame/g"
)

// DeepSeek V3 Think æ¨¡å‹ï¼ˆç”¨äºæ·±åº¦æ¨ç†ï¼‰
func OpenAIForDeepSeekV31Think(ctx context.Context) (model.ToolCallingChatModel, error) {
    modelName, _ := g.Cfg().Get(ctx, "ds_think_chat_model.model")
    apiKey, _ := g.Cfg().Get(ctx, "ds_think_chat_model.api_key")
    baseURL, _ := g.Cfg().Get(ctx, "ds_think_chat_model.base_url")

    config := &openai.ChatModelConfig{
        Model:   modelName.String(),
        APIKey:  apiKey.String(),
        BaseURL: baseURL.String(),
    }
    return openai.NewChatModel(ctx, config)
}

// DeepSeek V3 Quick æ¨¡å‹ï¼ˆç”¨äºå¿«é€Ÿå“åº”ï¼‰
func OpenAIForDeepSeekV3Quick(ctx context.Context) (model.ToolCallingChatModel, error) {
    modelName, _ := g.Cfg().Get(ctx, "ds_quick_chat_model.model")
    apiKey, _ := g.Cfg().Get(ctx, "ds_quick_chat_model.api_key")
    baseURL, _ := g.Cfg().Get(ctx, "ds_quick_chat_model.base_url")

    config := &openai.ChatModelConfig{
        Model:   modelName.String(),
        APIKey:  apiKey.String(),
        BaseURL: baseURL.String(),
    }
    return openai.NewChatModel(ctx, config)
}
```

## 6.2 Embedding ç»„ä»¶

**æ–‡ä»¶ä½ç½®**: `internal/ai/embedder/embedder.go`

```go
package embedder

import (
    "context"
    "github.com/cloudwego/eino-ext/components/embedding/ark"
    "github.com/cloudwego/eino/components/embedding"
    "github.com/gogf/gf/v2/frame/g"
)

func DoubaoEmbedding(ctx context.Context) (embedding.Embedder, error) {
    apiKey, _ := g.Cfg().Get(ctx, "doubao_embedding_model.api_key")
    model, _ := g.Cfg().Get(ctx, "doubao_embedding_model.model")

    apiType := ark.APITypeMultiModal
    return ark.NewEmbedder(ctx, &ark.EmbeddingConfig{
        APIKey:  apiKey.String(),
        Model:   model.String(),
        APIType: &apiType,
    })
}
```

---

# ç¬¬ä¸ƒç«  å‘é‡æ£€ç´¢ä¸å­˜å‚¨ç³»ç»Ÿ

æœ¬ç« è¯¦ç»†æè¿° Sentinel çš„å‘é‡å­˜å‚¨ä¸ RAG æ£€ç´¢ä½“ç³»ï¼Œæ¶µç›– Milvus é›†ç¾¤ç®¡ç†ã€Collection è®¾è®¡ã€Embedding ç”Ÿæˆã€æ–‡æ¡£ç´¢å¼•ã€è¯­ä¹‰æ£€ç´¢çš„å®Œæ•´é“¾è·¯ã€‚

## 7.1 æ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å‘é‡æ£€ç´¢ä¸å­˜å‚¨ç³»ç»Ÿ                          â”‚
â”‚                                                              â”‚
â”‚  å†™å…¥é“¾è·¯ (Indexing)                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚FileLoaderâ”‚â”€â”€â–¶â”‚MarkdownSplit â”‚â”€â”€â–¶â”‚ Doubao   â”‚â”€â”€â–¶â”‚Milvusâ”‚ â”‚
â”‚  â”‚/EventDataâ”‚   â”‚(æŒ‰æ ‡é¢˜åˆ†å—)   â”‚   â”‚Embedding â”‚   â”‚Index â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚(1024ç»´)  â”‚   â””â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚  è¯»å–é“¾è·¯ (Retrieval)                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚UserQuery â”‚â”€â”€â–¶â”‚ Doubao       â”‚â”€â”€â–¶â”‚ Milvus   â”‚â”€â”€â–¶â”‚Top-K â”‚ â”‚
â”‚  â”‚          â”‚   â”‚ Embedding    â”‚   â”‚ L2 Searchâ”‚   â”‚Docs  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 7.2 Milvus å®¢æˆ·ç«¯åˆå§‹åŒ–ä¸è‡ªåŠ¨å»ºåº“

**æ–‡ä»¶ä½ç½®**: `utility/client/client.go`

å®¢æˆ·ç«¯é‡‡ç”¨è‡ªåŠ¨åˆå§‹åŒ–ç­–ç•¥ï¼Œé¦–æ¬¡è¿æ¥æ—¶è‡ªåŠ¨åˆ›å»ºæ•°æ®åº“å’Œ Collectionï¼š

```go
func NewMilvusClient(ctx context.Context) (cli.Client, error) {
    // 1. å…ˆè¿æ¥ default æ•°æ®åº“
    defaultClient, err := cli.NewClient(ctx, cli.Config{
        Address: "localhost:19530",
        DBName:  "default",
    })

    // 2. æ£€æŸ¥ agent æ•°æ®åº“æ˜¯å¦å­˜åœ¨ï¼Œä¸å­˜åœ¨åˆ™åˆ›å»º
    databases, _ := defaultClient.ListDatabases(ctx)
    agentDBExists := false
    for _, db := range databases {
        if db.Name == common.MilvusDBName {
            agentDBExists = true
            break
        }
    }
    if !agentDBExists {
        defaultClient.CreateDatabase(ctx, common.MilvusDBName)
    }

    // 3. è¿æ¥ agent æ•°æ®åº“
    agentClient, _ := cli.NewClient(ctx, cli.Config{
        Address: "localhost:19530",
        DBName:  common.MilvusDBName,
    })

    // 4. æ£€æŸ¥å¹¶åˆ›å»º biz Collectionï¼ˆå«ç´¢å¼•å’ŒåŠ è½½ï¼‰
    // ... è¯¦è§ä¸‹èŠ‚
}
```

åˆå§‹åŒ–æµç¨‹ï¼šè¿æ¥ default â†’ æ£€æŸ¥/åˆ›å»º agent åº“ â†’ è¿æ¥ agent åº“ â†’ æ£€æŸ¥/åˆ›å»º biz Collection â†’ åˆ›å»ºå‘é‡ç´¢å¼• â†’ åŠ è½½ Collection åˆ°å†…å­˜ã€‚

## 7.3 Collection Schema è®¾è®¡

**Collection åç§°**: `biz`ï¼ˆä¸šåŠ¡çŸ¥è¯†é›†åˆï¼‰

```go
var fields = []*entity.Field{
    {
        Name:       "id",
        DataType:   entity.FieldTypeVarChar,
        TypeParams: map[string]string{"max_length": "256"},
        PrimaryKey: true,
    },
    {
        Name:       "vector",
        DataType:   entity.FieldTypeFloatVector,
        TypeParams: map[string]string{"dim": "1024"},  // è±†åŒ… Embedding ç»´åº¦
    },
    {
        Name:       "content",
        DataType:   entity.FieldTypeVarChar,
        TypeParams: map[string]string{"max_length": "8192"},
    },
    {
        Name:     "metadata",
        DataType: entity.FieldTypeJSON,  // åŠ¨æ€å…ƒæ•°æ®
    },
}
```

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| id | VarChar(256) | ä¸»é”®ï¼ŒUUID ç”Ÿæˆ |
| vector | FloatVector(1024) | è±†åŒ… Embedding å‘é‡ |
| content | VarChar(8192) | æ–‡æ¡£/äº‹ä»¶æ–‡æœ¬å†…å®¹ |
| metadata | JSON | åŠ¨æ€å…ƒæ•°æ®ï¼ˆç±»å‹ã€äº‹ä»¶IDã€ä¸¥é‡çº§åˆ«ç­‰ï¼‰ |

Schema å¯ç”¨äº† `EnableDynamicField: true`ï¼Œæ”¯æŒçµæ´»çš„å…ƒæ•°æ®æ‰©å±•ã€‚

**å‘é‡ç´¢å¼•é…ç½®**ï¼š

```go
// AUTOINDEX è‡ªåŠ¨é€‰æ‹©æœ€ä¼˜ç´¢å¼•ç±»å‹ï¼ŒL2 æ¬§æ°è·ç¦»åº¦é‡
vectorIndex, _ := entity.NewIndexAUTOINDEX(entity.L2)
agentClient.CreateIndex(ctx, "biz", "vector", vectorIndex, false)
agentClient.LoadCollection(ctx, "biz", false)  // åŠ è½½åˆ°å†…å­˜
```

## 7.4 Embedding ç”Ÿæˆ

**æ–‡ä»¶ä½ç½®**: `internal/ai/embedder/embedder.go`

æ‰€æœ‰æµæ°´çº¿å…±äº«åŒä¸€ä¸ª Embedding ç»„ä»¶ï¼ŒåŸºäºè±†åŒ…ï¼ˆByteDance ARKï¼‰å¤šæ¨¡æ€ Embedding æœåŠ¡ï¼š

```go
func NewEmbedding(ctx context.Context) (embedding.Embedder, error) {
    apiKey := g.Cfg().MustGet(ctx, "doubao_embedding_model.api_key").String()
    modelName := g.Cfg().MustGet(ctx, "doubao_embedding_model.model").String()
    return ark.NewEmbedder(ctx, &ark.EmbeddingConfig{
        APIKey:  apiKey,
        Model:   modelName,
        APIType: ark.APITypeMultiModal,
    })
}
```

- **æ¨¡å‹**: è±†åŒ…å¤šæ¨¡æ€ Embeddingï¼ˆep-20260222183953-gv8q5ï¼‰
- **ç»´åº¦**: 1024 ç»´æµ®ç‚¹å‘é‡
- **ä½¿ç”¨åœºæ™¯**: çŸ¥è¯†åº“ç´¢å¼•ã€äº‹ä»¶ç´¢å¼•ã€æ‰€æœ‰ Pipeline çš„ RAG æ£€ç´¢

## 7.5 æ–‡æ¡£ç´¢å¼•æµæ°´çº¿

**æ–‡ä»¶ä½ç½®**: `internal/ai/agent/knowledge_index_pipeline/`

çŸ¥è¯†åº“ç´¢å¼•é‡‡ç”¨ Eino Graph ç¼–æ’ï¼Œæµç¨‹ä¸ºï¼š

```
START â†’ FileLoader â†’ MarkdownSplitter â†’ MilvusIndexer â†’ END
```

**æ–‡æ¡£åˆ†å—ç­–ç•¥**ï¼ˆ`transformer.go`ï¼‰ï¼š

```go
// åŸºäº Markdown æ ‡é¢˜çš„åˆ†å—
markdown.NewHeaderSplitter(ctx, &markdown.HeaderSplitterConfig{
    Headers: map[string]string{
        "#": "title",  // æŒ‰ä¸€çº§æ ‡é¢˜åˆ†å—
    },
    TrimHeaders: false,
    IDGenerator: func(ctx context.Context, doc *schema.Document) string {
        return uuid.New().String()  // æ¯ä¸ªåˆ†å—ç”Ÿæˆå”¯ä¸€ UUID
    },
})
```

- æŒ‰ Markdown ä¸€çº§æ ‡é¢˜ `#` åˆ‡åˆ†æ–‡æ¡£
- æ¯ä¸ªåˆ†å—ä¿ç•™æ ‡é¢˜å±‚çº§ä¸Šä¸‹æ–‡
- æ¯ä¸ªåˆ†å—ç”Ÿæˆå”¯ä¸€ UUID ä½œä¸ºä¸»é”®

**äº‹ä»¶ç´¢å¼•**ï¼ˆ`event_indexer/indexer.go`ï¼‰ï¼š

å®‰å…¨äº‹ä»¶ç´¢å¼•æ—¶ï¼Œå†…å®¹æ‹¼æ¥å¤šä¸ªå­—æ®µå¹¶é™„å¸¦ç»“æ„åŒ–å…ƒæ•°æ®ï¼š

```go
content := fmt.Sprintf("æ ‡é¢˜: %s\nCVE: %s\nä¸¥é‡çº§åˆ«: %s\nå‚å•†: %s\näº§å“: %s\næè¿°: %s\nAIåˆ†æ: %s",
    event.Title, event.CVEID, event.Severity, ...)
// å†…å®¹æˆªæ–­åˆ° 7000 å­—ç¬¦

metadata := map[string]any{
    "type":       "security_event",
    "event_id":   event.ID,
    "severity":   event.Severity,
    "cve_id":     event.CVEID,
    "risk_score": event.RiskScore,
    "indexed_at": time.Now().Format(time.RFC3339),
}
```

## 7.6 è¯­ä¹‰æ£€ç´¢ï¼ˆRetrieverï¼‰

**æ–‡ä»¶ä½ç½®**: `internal/ai/retriever/retriever.go`

```go
func NewRetriever(ctx context.Context) (retriever.Retriever, error) {
    milvusClient, _ := client.NewMilvusClient(ctx)
    emb, _ := embedder.NewEmbedding(ctx)

    return milvus.NewRetriever(ctx, &milvus.RetrieverConfig{
        Client:      milvusClient,
        Collection:  common.MilvusCollectionName,  // "biz"
        VectorField: "vector",
        TopK:        3,
        Embedding:   emb,
        MetricType:  entity.L2,  // æ¬§æ°è·ç¦»
    })
}
```

| å‚æ•° | å€¼ | è¯´æ˜ |
|------|-----|------|
| Collection | biz | ä¸šåŠ¡çŸ¥è¯†é›†åˆ |
| VectorField | vector | å‘é‡å­—æ®µå |
| TopK | 3 | è¿”å›æœ€ç›¸ä¼¼çš„ 3 æ¡æ–‡æ¡£ |
| MetricType | L2 | æ¬§æ°è·ç¦»ï¼ˆå€¼è¶Šå°è¶Šç›¸ä¼¼ï¼‰ |

## 7.7 RAG åœ¨ Pipeline ä¸­çš„é›†æˆ

æ¯ä¸ª Agent Pipelineï¼ˆChat/Event/Report/Riskï¼‰éƒ½é‡‡ç”¨ç›¸åŒçš„ RAG æ¨¡å¼ï¼Œä»¥ Chat Pipeline ä¸ºä¾‹ï¼š

```
START â”€â”€â”¬â”€â”€â–¶ InputToRag â”€â”€â–¶ MilvusRetriever â”€â”€â”
        â”‚                                      â”œâ”€â”€â–¶ ChatTemplate â”€â”€â–¶ ReactAgent â”€â”€â–¶ END
        â””â”€â”€â–¶ InputToChat â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

å…³é”®è®¾è®¡ï¼š
- **å¹¶è¡Œåˆ†æ”¯**: `InputToRag` å’Œ `InputToChat` ä» START å¹¶è¡Œæ‰§è¡Œ
- **AllPredecessor è§¦å‘**: ChatTemplate ç­‰å¾…ä¸¤ä¸ªå‰é©±èŠ‚ç‚¹éƒ½å®Œæˆåæ‰æ‰§è¡Œ
- **OutputKey æ˜ å°„**: MilvusRetriever çš„è¾“å‡º key è®¾ä¸º `"documents"`ï¼Œä¸ ChatTemplate ä¸­çš„ `{documents}` å ä½ç¬¦å¯¹åº”

æ£€ç´¢ç»“æœæ³¨å…¥åˆ°ç³»ç»Ÿ Prompt ä¸­ï¼š

```
<related_docs>
{documents}
</related_docs>
```

## 7.8 ç›¸ä¼¼äº‹ä»¶æœç´¢å·¥å…·

**æ–‡ä»¶ä½ç½®**: `internal/ai/tools/search_similar_events.go`

é™¤äº† Pipeline å†…ç½®çš„ RAG æ£€ç´¢ï¼Œç³»ç»Ÿè¿˜æä¾›äº† `SearchSimilarEvents` å·¥å…·ä¾› Agent ä¸»åŠ¨è°ƒç”¨ï¼š

```go
// è¾“å…¥å‚æ•°
type SearchSimilarEventsInput struct {
    Query string `json:"query"`  // æœç´¢æŸ¥è¯¢
    Limit int    `json:"limit"`  // æœ€å¤§ç»“æœæ•°ï¼ˆ1-5ï¼Œé»˜è®¤3ï¼‰
}
```

è¯¥å·¥å…·åˆå§‹åŒ–ç‹¬ç«‹çš„ MilvusRetrieverï¼Œæ‰§è¡Œè¯­ä¹‰æœç´¢åè¿”å›æ–‡æ¡£å†…å®¹ã€å…ƒæ•°æ®å’Œç›¸ä¼¼åº¦åˆ†æ•°ã€‚Agent å¯åœ¨ ReAct æ¨ç†è¿‡ç¨‹ä¸­æŒ‰éœ€è°ƒç”¨æ­¤å·¥å…·è¿›è¡ŒçŸ¥è¯†æ£€ç´¢ã€‚

---

# ç¬¬å…«ç«  Multi-Agent Supervisor å¤šæ™ºèƒ½ä½“æ¶æ„

æœ¬ç« è¯¦ç»†æè¿° Sentinel çš„å¤šæ™ºèƒ½ä½“åä½œæ¶æ„ã€‚ç³»ç»Ÿé‡‡ç”¨ Supervisorï¼ˆä¸»ç®¡ï¼‰æ¨¡å¼ï¼Œç”±ä¸€ä¸ª Host Agent è´Ÿè´£æ„å›¾è¯†åˆ«å’Œä»»åŠ¡åˆ†å‘ï¼Œå°†è¯·æ±‚è·¯ç”±åˆ° 5 ä¸ªä¸“ä¸šåŒ–çš„ Sub-Agent æ‰§è¡Œã€‚

## 8.1 æ¶æ„æ¦‚è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Supervisor (Host Agent)                  â”‚
â”‚                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              SupervisorGraph (Eino Compose)         â”‚   â”‚
â”‚  â”‚                                                      â”‚   â”‚
â”‚  â”‚  START                                               â”‚   â”‚
â”‚  â”‚    â”‚                                                 â”‚   â”‚
â”‚  â”‚    â–¼                                                 â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚   â”‚
â”‚  â”‚  â”‚  Router (LLM æ„å›¾åˆ†ç±»)            â”‚               â”‚   â”‚
â”‚  â”‚  â”‚  DeepSeek V3 Quick â†’ JSONè¾“å‡º     â”‚               â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚   â”‚
â”‚  â”‚                 â”‚                                    â”‚   â”‚
â”‚  â”‚                 â–¼                                    â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚   â”‚
â”‚  â”‚  â”‚  Executor (Agent åˆ†å‘æ‰§è¡Œ)        â”‚               â”‚   â”‚
â”‚  â”‚  â”‚  Registry æŸ¥æ‰¾ â†’ SubAgent.Execute â”‚               â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚   â”‚
â”‚  â”‚                 â”‚                                    â”‚   â”‚
â”‚  â”‚                 â–¼                                    â”‚   â”‚
â”‚  â”‚               END                                    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                            â”‚
â”‚  SharedMemory (åˆ†å±‚ä¸Šä¸‹æ–‡ç®¡ç†)                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ messages[] + summary + context{} + è‡ªåŠ¨å‹ç¼©         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”
    â–¼         â–¼        â–¼        â–¼        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”
â”‚  Chat  â”‚â”‚Event â”‚â”‚Reportâ”‚â”‚Risk â”‚â”‚ Plan â”‚
â”‚ Agent  â”‚â”‚Agent â”‚â”‚Agent â”‚â”‚Agentâ”‚â”‚Agent â”‚
â”‚RAG+    â”‚â”‚RAG+  â”‚â”‚RAG+  â”‚â”‚RAG+ â”‚â”‚PER   â”‚
â”‚ReAct   â”‚â”‚ReAct â”‚â”‚ReAct â”‚â”‚ReActâ”‚â”‚æ¨¡å¼  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”˜
```

## 8.2 Agent ç±»å‹å®šä¹‰ä¸æ³¨å†Œ

**æ–‡ä»¶ä½ç½®**: `internal/ai/agent/supervisor/types.go`

ç³»ç»Ÿå®šä¹‰äº† 5 ç§ä¸“ä¸šåŒ– Agent ç±»å‹ï¼š

```go
type AgentType string

const (
    AgentChat   AgentType = "chat"    // é€šç”¨å¯¹è¯ã€å®‰å…¨å’¨è¯¢ã€çŸ¥è¯†é—®ç­”
    AgentEvent  AgentType = "event"   // å®‰å…¨äº‹ä»¶æŸ¥è¯¢ã€äº‹ä»¶åˆ†æã€å…³è”åˆ†æ
    AgentReport AgentType = "report"  // æŠ¥å‘Šç”Ÿæˆã€æŠ¥å‘ŠæŸ¥çœ‹ã€æ•°æ®åˆ†æ
    AgentRisk   AgentType = "risk"    // é£é™©è¯„ä¼°ã€å¨èƒåˆ†æã€CVE è¯„ä¼°
    AgentPlan   AgentType = "plan"    // å¤æ‚å¤šæ­¥éª¤ä»»åŠ¡ã€éœ€è¦è§„åˆ’çš„æ“ä½œ
)
```

æ¯ä¸ª Agent å®ç°ç»Ÿä¸€çš„ `SubAgent` æ¥å£ï¼š

```go
// SubAgent æ¥å£ - æ‰€æœ‰å­ Agent å¿…é¡»å®ç°
type SubAgent interface {
    Name() AgentType
    Execute(ctx context.Context, task *Task, cb StreamCallback) (*Result, error)
}
```

**Agent æ³¨å†Œè¡¨**ï¼ˆ`registry.go`ï¼‰é‡‡ç”¨çº¿ç¨‹å®‰å…¨çš„å…¨å±€æ³¨å†Œæ¨¡å¼ï¼š

```go
var (
    agents  = make(map[AgentType]SubAgent)
    agentMu sync.RWMutex
)

func RegisterAgent(agent SubAgent) {
    agentMu.Lock()
    defer agentMu.Unlock()
    agents[agent.Name()] = agent
}

func GetAgent(t AgentType) SubAgent {
    agentMu.RLock()
    defer agentMu.RUnlock()
    return agents[t]
}
```

## 8.3 SupervisorGraph ç¼–æ’

**æ–‡ä»¶ä½ç½®**: `internal/ai/agent/supervisor/orchestration.go`

Supervisor çš„æ ¸å¿ƒç¼–æ’ä½¿ç”¨ Eino Compose Graphï¼Œå®šä¹‰äº†ä¸¤ä¸ªèŠ‚ç‚¹çš„çº¿æ€§æµç¨‹ï¼š

```go
func BuildSupervisorGraph(ctx context.Context) (compose.Runnable[*SupervisorInput, *SupervisorOutput], error) {
    g := compose.NewGraph[*SupervisorInput, *SupervisorOutput]()

    // èŠ‚ç‚¹1: Router - LLM æ„å›¾åˆ†ç±»
    routerLambda, _ := newRouterLambda(ctx)
    g.AddLambdaNode(NodeRouter, routerLambda, compose.WithNodeName("IntentRouter"))

    // èŠ‚ç‚¹2: Executor - æ‰§è¡Œå¯¹åº”çš„ SubAgent
    executorLambda := newExecutorLambda()
    g.AddLambdaNode(NodeExecutor, executorLambda, compose.WithNodeName("AgentExecutor"))

    // è¿æ¥: START â†’ Router â†’ Executor â†’ END
    g.AddEdge(compose.START, NodeRouter)
    g.AddEdge(NodeRouter, NodeExecutor)
    g.AddEdge(NodeExecutor, compose.END)

    return g.Compile(ctx, compose.WithGraphName("SupervisorGraph"))
}
```

## 8.4 Router æ„å›¾è·¯ç”±

**æ–‡ä»¶ä½ç½®**: `internal/ai/agent/supervisor/router.go`

Router ä½¿ç”¨ DeepSeek V3 Quickï¼ˆè½»é‡å¿«é€Ÿæ¨¡å‹ï¼‰è¿›è¡Œæ„å›¾åˆ†ç±»ï¼Œè¾“å‡º JSON æ ¼å¼çš„è·¯ç”±ç»“æœï¼š

```go
func classifyIntent(ctx context.Context, m model.ToolCallingChatModel, query string) (AgentType, error) {
    prompt := buildClassifyPrompt(query)
    resp, _ := m.Generate(ctx, []*schema.Message{schema.UserMessage(prompt)})
    return parseAgentType(resp.Content), nil
}
```

åˆ†ç±» Prompt åŒ…å«æ˜ç¡®çš„ Agent èŒè´£æè¿°å’Œç¤ºä¾‹ï¼š

```
<agents>
- chat: é€šç”¨å¯¹è¯ã€å®‰å…¨å’¨è¯¢ã€çŸ¥è¯†é—®ç­”ã€æ—¥å¿—æŸ¥è¯¢ã€è®¢é˜…ç®¡ç†ï¼ˆé»˜è®¤é€‰é¡¹ï¼‰
- event: å®‰å…¨äº‹ä»¶æŸ¥è¯¢ã€äº‹ä»¶åˆ†æã€äº‹ä»¶å…³è”ã€å‘Šè­¦å…³è”
- report: ç”ŸæˆæŠ¥å‘Šã€æŸ¥çœ‹æŠ¥å‘Šã€æŠ¥å‘Šæ•°æ®åˆ†æ
- risk: é£é™©è¯„ä¼°ã€å¨èƒåˆ†æã€æ¼æ´è¯„ä¼°ã€CVEåˆ†æ
- plan: å¤æ‚å¤šæ­¥éª¤ä»»åŠ¡ã€éœ€è¦è§„åˆ’çš„æ“ä½œ
</agents>

<examples>
"æœ€è¿‘æœ‰ä»€ä¹ˆå®‰å…¨äº‹ä»¶" â†’ event
"å¸®æˆ‘ç”Ÿæˆæœ¬å‘¨å®‰å…¨æŠ¥å‘Š" â†’ report
"è¯„ä¼°è¿™ä¸ªCVEçš„é£é™©" â†’ risk
"å¸®æˆ‘éƒ¨ç½²ä¸€å¥—ç›‘æ§ç³»ç»Ÿ" â†’ plan
"æŸ¥ä¸€ä¸‹æ—¥å¿—" â†’ chat
</examples>
```

**é™çº§ç­–ç•¥**: åˆ†ç±»å¤±è´¥æ—¶è‡ªåŠ¨é™çº§åˆ° `AgentChat`ï¼Œç¡®ä¿ç³»ç»Ÿå§‹ç»ˆå¯ç”¨ã€‚

## 8.5 Executor ä»»åŠ¡æ‰§è¡Œ

**æ–‡ä»¶ä½ç½®**: `internal/ai/agent/supervisor/executor.go`

Executor ä» Registry æŸ¥æ‰¾å¯¹åº”çš„ SubAgent å¹¶æ‰§è¡Œï¼š

```go
func newExecutorLambda() *compose.Lambda {
    return compose.InvokableLambda(func(ctx context.Context, input *RouterOutput) (*SupervisorOutput, error) {
        agent := GetAgent(input.AgentType)
        if agent == nil {
            agent = GetAgent(AgentChat)  // å…œåº•åˆ° Chat Agent
        }

        task := &Task{
            ID:    generateTaskID(),  // åŸå­è®¡æ•°å™¨ç”Ÿæˆ task_1, task_2, ...
            Query: input.Input.Query,
            Type:  input.AgentType,
        }

        result, err := agent.Execute(ctx, task, input.Input.Callback)
        // é”™è¯¯ä¸ä¸­æ–­ Graphï¼Œè¿”å› nil error è®©æµç¨‹ç»§ç»­
        return &SupervisorOutput{...}, nil
    })
}
```

å…³é”®è®¾è®¡ï¼š
- **åŒé‡å…œåº•**: Agent æœªæ‰¾åˆ°æ—¶é™çº§åˆ° Chat Agent
- **é”™è¯¯éš”ç¦»**: SubAgent æ‰§è¡Œé”™è¯¯ä¸ä¼šä¸­æ–­ Graph æµç¨‹
- **æµå¼å›è°ƒ**: é€šè¿‡ `StreamCallback` å®æ—¶æ¨é€æ‰§è¡Œè¿›åº¦

## 8.6 SharedMemory åˆ†å±‚ä¸Šä¸‹æ–‡ç®¡ç†

**æ–‡ä»¶ä½ç½®**: `internal/ai/agent/supervisor/memory.go`

SharedMemory å®ç°äº†è·¨ Agent çš„ä¸Šä¸‹æ–‡å…±äº«å’Œè‡ªåŠ¨å‹ç¼©æœºåˆ¶ï¼š

```go
type SharedMemory struct {
    mu            sync.RWMutex
    messages      []*MessageMeta   // æ¶ˆæ¯åˆ—è¡¨ï¼ˆå¸¦å…ƒæ•°æ®ï¼‰
    context       map[string]any   // é”®å€¼ä¸Šä¸‹æ–‡
    summary       string           // å†å²å¯¹è¯æ‘˜è¦
    maxTokens     int              // æœ€å¤§ token æ•°ï¼ˆ4000ï¼‰
    summaryTokens int              // æ‘˜è¦å ç”¨çš„ token æ•°
}

type MessageMeta struct {
    Message   *schema.Message
    Timestamp time.Time
    Tokens    int       // ä¼°ç®— token æ•°ï¼ˆå­—ç¬¦æ•°/3ï¼‰
    Important bool      // å·¥å…·è°ƒç”¨ç»“æœæ ‡è®°ä¸ºé‡è¦
    Tags      []string  // tool_call, tool_result, query, answer
}
```

**è‡ªåŠ¨å‹ç¼©ç­–ç•¥**ï¼ˆ`compressIfNeeded`ï¼‰ï¼š

å½“æ€» token æ•°è¶…è¿‡ 4000 é™åˆ¶æ—¶è§¦å‘å‹ç¼©ï¼š
1. ä»åå¾€å‰ä¿ç•™æœ€è¿‘ 10 æ¡æ¶ˆæ¯
2. æ ‡è®°ä¸º `Important` çš„æ¶ˆæ¯ï¼ˆå·¥å…·è°ƒç”¨ç»“æœï¼‰å§‹ç»ˆä¿ç•™
3. è¶…å‡ºèŒƒå›´çš„æ—§æ¶ˆæ¯ç”Ÿæˆæ–‡æœ¬æ‘˜è¦
4. æ‘˜è¦æ ¼å¼ï¼š`[å†å²æ‘˜è¦] ç”¨æˆ·é—®: xxx; å›ç­”: xxx; ...`

```go
func (m *SharedMemory) compressIfNeeded() {
    // è®¡ç®—æ€» token
    totalTokens := m.summaryTokens
    for _, meta := range m.messages {
        totalTokens += meta.Tokens
    }
    if totalTokens <= m.maxTokens { return }

    // ä¿ç•™æœ€è¿‘ 10 æ¡ + æ‰€æœ‰é‡è¦æ¶ˆæ¯ï¼Œå…¶ä½™å‹ç¼©ä¸ºæ‘˜è¦
    // ...
}
```

## 8.7 Supervisor ä¸»å…¥å£

**æ–‡ä»¶ä½ç½®**: `internal/ai/agent/supervisor/supervisor.go`

```go
type Supervisor struct {
    ctx    context.Context
    memory *SharedMemory
}

func (s *Supervisor) Execute(query string, cb StreamCallback) (*Result, error) {
    // 1. è®°å½•ç”¨æˆ·æ¶ˆæ¯åˆ° SharedMemory
    s.memory.AddMessage(schema.UserMessage(query))

    // 2. æ„å»ºå¹¶æ‰§è¡Œ SupervisorGraph
    graph, _ := BuildSupervisorGraph(s.ctx)
    output, _ := graph.Invoke(s.ctx, &SupervisorInput{Query: query, Callback: cb})

    // 3. è®°å½• Agent å›å¤åˆ° SharedMemory
    if output.Content != "" {
        s.memory.AddMessage(schema.AssistantMessage(output.Content, nil))
    }

    return &Result{TaskID: output.TaskID, Agent: output.Agent, Content: output.Content}, nil
}
```

å®Œæ•´çš„è¯·æ±‚å¤„ç†æµç¨‹ï¼šç”¨æˆ·æ¶ˆæ¯ â†’ SharedMemory è®°å½• â†’ Router æ„å›¾åˆ†ç±» â†’ Executor åˆ†å‘åˆ° SubAgent â†’ SubAgent æ‰§è¡Œï¼ˆRAG + ReActï¼‰â†’ ç»“æœå†™å› SharedMemory â†’ è¿”å›å“åº”ã€‚

## 8.8 å„ SubAgent å®ç°

5 ä¸ª SubAgent åˆ†åˆ«åœ¨ `agent_chat.go`ã€`agent_event.go`ã€`agent_report.go`ã€`agent_risk.go`ã€`agent_plan.go` ä¸­å®ç°ã€‚

| Agent | æ„å»ºå‡½æ•° | å†…éƒ¨æ¶æ„ | èŒè´£ |
|-------|---------|---------|------|
| ChatAgent | `BuildChatAgent()` | RAG + ReAct | é€šç”¨å¯¹è¯ã€çŸ¥è¯†é—®ç­”ã€æ—¥å¿—æŸ¥è¯¢ |
| EventAgent | `BuildEventAnalysisAgent()` | RAG + ReAct | å®‰å…¨äº‹ä»¶åˆ†æã€å…³è”åˆ†æ |
| ReportAgent | `BuildReportAgent()` | RAG + ReAct | æŠ¥å‘Šç”Ÿæˆä¸æ•°æ®åˆ†æ |
| RiskAgent | `BuildRiskAgent()` | RAG + ReAct | é£é™©è¯„ä¼°ã€CVE åˆ†æ |
| PlanAgent | `BuildPlanAgent()` | Plan-Execute-Replan | å¤æ‚å¤šæ­¥éª¤ä»»åŠ¡è§„åˆ’ä¸æ‰§è¡Œ |

å‰ 4 ä¸ª Agent å…±äº«ç›¸åŒçš„ Pipeline æ¨¡å¼ï¼ˆRAG + ReActï¼‰ï¼ŒåŒºåˆ«åœ¨äºå„è‡ªçš„ç³»ç»Ÿ Prompt å’Œå¯ç”¨å·¥å…·é›†ã€‚PlanAgent ä½¿ç”¨ç‹¬ç«‹çš„ Plan-Execute-Replan æ¨¡å¼ï¼ˆè¯¦è§ç¬¬ä¹ç« ï¼‰ã€‚

---

# ç¬¬ä¹ç«  Plan-Execute-Replan æ¨¡å¼

## 9.1 æ¨¡å¼æ¦‚è¿°

Plan-Execute-Replanï¼ˆPERï¼‰æ˜¯åŸºäº Eino ADK é¢„æ„å»ºçš„é«˜çº§ Agent æ¨¡å¼ï¼Œä¸“é—¨å¤„ç†éœ€è¦å¤šæ­¥éª¤è§„åˆ’çš„å¤æ‚ä»»åŠ¡ã€‚è¯¥æ¨¡å¼å°†ä»»åŠ¡åˆ†è§£ä¸ºè®¡åˆ’ã€æ‰§è¡Œã€é‡è§„åˆ’ä¸‰ä¸ªé˜¶æ®µï¼Œæ”¯æŒæœ€å¤š 20 æ¬¡è¿­ä»£å¾ªç¯ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            Plan-Execute-Replan å·¥ä½œæµç¨‹                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚   Planner    â”‚â”€â–¶â”‚   Executor   â”‚â”€â–¶â”‚ Replanner  â”‚   â”‚
â”‚   â”‚ DeepSeek V3  â”‚  â”‚ DeepSeek V3  â”‚  â”‚ DeepSeek V3â”‚   â”‚
â”‚   â”‚   Think      â”‚  â”‚   Quick      â”‚  â”‚   Think    â”‚   â”‚
â”‚   â”‚ (æ·±åº¦æ¨ç†)    â”‚  â”‚ (å¿«é€Ÿæ‰§è¡Œ)    â”‚  â”‚ (é‡æ–°è§„åˆ’) â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚        â–²                   â”‚                â”‚           â”‚
â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚              (æœ€å¤š 20 æ¬¡è¿­ä»£å¾ªç¯)                        â”‚
â”‚                                                         â”‚
â”‚   Executor å¯ç”¨å·¥å…·:                                    â”‚
â”‚   Log(MCP) â”‚ Prometheus â”‚ InternalDocs â”‚ CurrentTime    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 9.2 æ ¸å¿ƒå®ç°

**æ–‡ä»¶ä½ç½®**: `internal/ai/agent/plan_execute_replan/plan_execute_replan.go`

```go
package plan_execute_replan

import (
    "context"
    "github.com/cloudwego/eino/adk"
    "github.com/cloudwego/eino/adk/prebuilt/planexecute"
)

func BuildPlanAgent(ctx context.Context, query string) (string, []string, error) {
    // åˆ›å»ºä¸‰ä¸ªå­ Agent
    planAgent, _ := NewPlanner(ctx)
    executeAgent, _ := NewExecutor(ctx)
    replanAgent, _ := NewRePlanAgent(ctx)

    // ç»„è£… Plan-Execute-Replan Agent
    planExecuteAgent, _ := planexecute.New(ctx, &planexecute.Config{
        Planner:       planAgent,
        Executor:      executeAgent,
        Replanner:     replanAgent,
        MaxIterations: 20,
    })

    // åˆ›å»º Runner å¹¶æ‰§è¡Œ
    r := adk.NewRunner(ctx, adk.RunnerConfig{Agent: planExecuteAgent})
    iter := r.Query(ctx, query)

    // è¿­ä»£è·å–ç»“æœ
    var lastMessage adk.Message
    for {
        event, ok := iter.Next()
        if !ok { break }
        if event.Output != nil {
            lastMessage, _, _ = adk.GetMessage(event)
        }
    }
    return lastMessage.Content, nil, nil
}
```

## 9.3 Planner è§„åˆ’å™¨

**æ–‡ä»¶ä½ç½®**: `internal/ai/agent/plan_execute_replan/planner.go`

```go
func NewPlanner(ctx context.Context) (adk.Agent, error) {
    planModel, _ := models.OpenAIForDeepSeekV31Think(ctx)
    return planexecute.NewPlanner(ctx, &planexecute.PlannerConfig{
        ToolCallingChatModel: planModel,
    })
}
```

## 9.4 Executor æ‰§è¡Œå™¨

**æ–‡ä»¶ä½ç½®**: `internal/ai/agent/plan_execute_replan/executor.go`

Executor ä½¿ç”¨ DeepSeek V3 Quickï¼ˆå¿«é€Ÿæ¨¡å‹ï¼‰æ‰§è¡Œå…·ä½“æ­¥éª¤ï¼Œé…å¤‡ 4 ç±»å·¥å…·ï¼š

```go
func NewExecutor(ctx context.Context) (adk.Agent, error) {
    // MCP åè®®æ—¥å¿—æŸ¥è¯¢å·¥å…·
    mcpTool, _ := tools.GetLogMcpTool()
    toolList := mcpTool
    // Prometheus å‘Šè­¦æŸ¥è¯¢
    toolList = append(toolList, tools.NewPrometheusAlertsQueryTool())
    // å†…éƒ¨æ–‡æ¡£æŸ¥è¯¢
    toolList = append(toolList, tools.NewQueryInternalDocsTool())
    // å½“å‰æ—¶é—´
    toolList = append(toolList, tools.NewGetCurrentTimeTool())

    execModel, _ := models.OpenAIForDeepSeekV3Quick(ctx)
    return planexecute.NewExecutor(ctx, &planexecute.ExecutorConfig{
        Model:         execModel,
        ToolsConfig:   adk.ToolsConfig{
            ToolsNodeConfig: compose.ToolsNodeConfig{Tools: toolList},
        },
        MaxIterations: 999999,  // å•æ­¥éª¤å†…ä¸é™åˆ¶å·¥å…·è°ƒç”¨æ¬¡æ•°
    })
}
```

## 9.5 Replanner é‡è§„åˆ’å™¨

**æ–‡ä»¶ä½ç½®**: `internal/ai/agent/plan_execute_replan/replan.go`

```go
func NewRePlanAgent(ctx context.Context) (adk.Agent, error) {
    model, _ := models.OpenAIForDeepSeekV31Think(ctx)
    return planexecute.NewReplanner(ctx, &planexecute.ReplannerConfig{
        ChatModel: model,  // ä½¿ç”¨ Think æ¨¡å‹è¿›è¡Œæ·±åº¦æ¨ç†
    })
}
```

**æ¨¡å‹é€‰æ‹©ç­–ç•¥**ï¼š

| ç»„ä»¶ | æ¨¡å‹ | åŸå›  |
|------|------|------|
| Planner | DeepSeek V3 Think | éœ€è¦æ·±åº¦æ¨ç†èƒ½åŠ›æ¥åˆ¶å®šè®¡åˆ’ |
| Executor | DeepSeek V3 Quick | æ‰§è¡Œå…·ä½“æ­¥éª¤ï¼Œéœ€è¦å¿«é€Ÿå“åº” |
| Replanner | DeepSeek V3 Think | éœ€è¦åˆ†ææ‰§è¡Œç»“æœå¹¶é‡æ–°è§„åˆ’ |

---

# ç¬¬åç«  Skill æŠ€èƒ½ç³»ç»Ÿ

## 10.1 æ¦‚è¿°

Skill æŠ€èƒ½ç³»ç»Ÿæ˜¯ Sentinel çš„é¢„å®šä¹‰ä»»åŠ¡æ‰§è¡Œæ¡†æ¶ï¼Œå°†å¸¸è§çš„å®‰å…¨è¿ç»´æ“ä½œå°è£…ä¸ºå¯å‚æ•°åŒ–çš„æŠ€èƒ½å•å…ƒã€‚æ¯ä¸ª Skill å†…éƒ¨ä½¿ç”¨ ReAct Agent é©±åŠ¨ï¼Œé…å¤‡ç‰¹å®šçš„å·¥å…·é›†å’Œ Prompt æ¨¡æ¿ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Skill æŠ€èƒ½ç³»ç»Ÿ                   â”‚
â”‚                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚äº‹ä»¶åˆ†æ   â”‚  â”‚æ—¥å¿—è¯Šæ–­   â”‚  â”‚å¨èƒç‹©çŒ   â”‚  â”‚
â”‚  â”‚event_    â”‚  â”‚log_      â”‚  â”‚threat_   â”‚  â”‚
â”‚  â”‚analysis  â”‚  â”‚diagnosis â”‚  â”‚hunting   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â”‚
â”‚       â”‚              â”‚              â”‚        â”‚
â”‚       â–¼              â–¼              â–¼        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚         Executor (ReAct Agent)        â”‚   â”‚
â”‚  â”‚  Promptæ¨¡æ¿ + å‚æ•°æ›¿æ¢ + å·¥å…·é€‰æ‹©     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 10.2 Skill å®šä¹‰

**æ–‡ä»¶ä½ç½®**: `internal/ai/skills/types.go`

```go
type Skill struct {
    ID          string       `json:"id"`
    Name        string       `json:"name"`
    Description string       `json:"description"`
    Category    string       `json:"category"`
    Enabled     bool         `json:"enabled"`
    Tools       []string     `json:"tools"`       // å¯ç”¨å·¥å…·ååˆ—è¡¨
    Prompt      string       `json:"-"`            // Prompt æ¨¡æ¿ï¼ˆå«å‚æ•°å ä½ç¬¦ï¼‰
    Params      []SkillParam `json:"params"`       // å‚æ•°å®šä¹‰
}
```

---

# ç¬¬åä¸€ç«  API å±‚ä¸æœåŠ¡é›†æˆ

## 11.1 API å®šä¹‰

**æ–‡ä»¶ä½ç½®**: `api/chat/v1/chat.go`

```go
type ChatReq struct {
    g.Meta   `path:"/chat" method:"post"`
    Id       string
    Question string
}

type ChatRes struct {
    Answer string `json:"answer"`
}
```

## 11.2 Controller å®ç°

**æ–‡ä»¶ä½ç½®**: `internal/controller/chat/chat_v1_chat.go`

```go
func (c *ControllerV1) Chat(ctx context.Context, req *v1.ChatReq) (*v1.ChatRes, error) {
    userMessage := &chat_pipeline.UserMessage{
        ID:      req.Id,
        Query:   req.Question,
        History: mem.GetSimpleMemory(req.Id).GetMessages(),
    }

    runner, _ := chat_pipeline.BuildChatAgent(ctx)
    out, _ := runner.Invoke(ctx, userMessage, compose.WithCallbacks(log_call_back.LogCallback(nil)))

    // ä¿å­˜å¯¹è¯å†å²
    mem.GetSimpleMemory(req.Id).SetMessages(schema.UserMessage(req.Question))
    mem.GetSimpleMemory(req.Id).SetMessages(schema.SystemMessage(out.Content))

    return &v1.ChatRes{Answer: out.Content}, nil
}
```

## 11.3 ä¼šè¯è®°å¿†ç®¡ç†

**æ–‡ä»¶ä½ç½®**: `utility/mem/mem.go`

```go
type SimpleMemory struct {
    ID            string
    Messages      []*schema.Message
    MaxWindowSize int
}

func (c *SimpleMemory) SetMessages(msg *schema.Message) {
    c.Messages = append(c.Messages, msg)
    if len(c.Messages) > c.MaxWindowSize {
        excess := len(c.Messages) - c.MaxWindowSize
        if excess%2 != 0 { excess++ }
        c.Messages = c.Messages[excess:]
    }
}
```

---

# ç¬¬åäºŒç«  ç³»ç»Ÿä¼˜åŒ–ä¸å·¥ç¨‹å®è·µ

## 12.1 å¤šæ¨¡å‹åˆ†çº§è°ƒåº¦

ç³»ç»Ÿæ ¹æ®ä»»åŠ¡å¤æ‚åº¦é€‰æ‹©ä¸åŒçš„æ¨¡å‹ï¼Œå¹³è¡¡æ¨ç†è´¨é‡ä¸å“åº”é€Ÿåº¦ï¼š

| åœºæ™¯ | æ¨¡å‹ | ç‰¹ç‚¹ |
|------|------|------|
| æ„å›¾è·¯ç”±ï¼ˆRouterï¼‰ | DeepSeek V3 Quick | è½»é‡å¿«é€Ÿï¼Œæ¯«ç§’çº§åˆ†ç±» |
| å¯¹è¯/äº‹ä»¶/æŠ¥å‘Š/é£é™© Agent | DeepSeek V3 | é€šç”¨æ¨ç†ï¼Œå·¥å…·è°ƒç”¨ |
| è®¡åˆ’åˆ¶å®šï¼ˆPlannerï¼‰ | DeepSeek V3 Think | æ·±åº¦æ¨ç†ï¼Œå¤æ‚è§„åˆ’ |
| é‡è§„åˆ’ï¼ˆReplannerï¼‰ | DeepSeek V3 Think | åˆ†ææ‰§è¡Œç»“æœï¼Œè°ƒæ•´ç­–ç•¥ |
| æ­¥éª¤æ‰§è¡Œï¼ˆPER Executorï¼‰ | DeepSeek V3 Quick | å¿«é€Ÿæ‰§è¡Œå…·ä½“æ“ä½œ |
| Skill æ‰§è¡Œ | DeepSeek V3 Quick | é¢„å®šä¹‰ä»»åŠ¡å¿«é€Ÿå®Œæˆ |

è¿™ç§åˆ†çº§ç­–ç•¥é¿å…äº†å¯¹æ‰€æœ‰ä»»åŠ¡ä½¿ç”¨åŒä¸€æ¨¡å‹çš„æµªè´¹ï¼ŒThink æ¨¡å‹ä»…ç”¨äºéœ€è¦æ·±åº¦æ¨ç†çš„è§„åˆ’åœºæ™¯ã€‚

## 12.2 å¹¶è¡Œ Graph æ‰§è¡Œä¼˜åŒ–

Chat Pipeline é‡‡ç”¨å¹¶è¡Œåˆ†æ”¯è®¾è®¡ï¼ŒRAG æ£€ç´¢ä¸ç”¨æˆ·è¾“å…¥å¤„ç†åŒæ—¶è¿›è¡Œï¼š

```
START â”€â”€â”¬â”€â”€â–¶ InputToRag â”€â”€â–¶ MilvusRetriever â”€â”€â”
        â”‚                                      â”œâ”€â”€â–¶ ChatTemplate â”€â”€â–¶ ReactAgent
        â””â”€â”€â–¶ InputToChat â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

å…³é”®ä¼˜åŒ–ç‚¹ï¼š
- `InputToRag` å’Œ `InputToChat` ä» START å¹¶è¡Œæ‰§è¡Œï¼Œä¸äº’ç›¸é˜»å¡
- `compose.WithNodeTriggerMode(compose.AllPredecessor)` ç¡®ä¿ ChatTemplate ç­‰å¾…ä¸¤ä¸ªå‰é©±éƒ½å®Œæˆ
- å‘é‡æ£€ç´¢ä¸è¾“å…¥é¢„å¤„ç†çš„å»¶è¿Ÿè¢«å¹¶è¡ŒåŒ–éšè—

## 12.3 SharedMemory è‡ªåŠ¨å‹ç¼©

Supervisor çš„ SharedMemory å®ç°äº†æ™ºèƒ½çš„ä¸Šä¸‹æ–‡ç®¡ç†ï¼š

- **Token é¢„ç®—æ§åˆ¶**: æœ€å¤§ 4000 tokensï¼Œè¶…å‡ºè‡ªåŠ¨è§¦å‘å‹ç¼©
- **é‡è¦æ€§æ ‡è®°**: å·¥å…·è°ƒç”¨ç»“æœï¼ˆ`tool_call`/`tool_result`ï¼‰æ ‡è®°ä¸º Importantï¼Œå‹ç¼©æ—¶ä¼˜å…ˆä¿ç•™
- **æ»‘åŠ¨çª—å£**: ä¿ç•™æœ€è¿‘ 10 æ¡æ¶ˆæ¯ + æ‰€æœ‰é‡è¦æ¶ˆæ¯
- **æ‘˜è¦ç”Ÿæˆ**: è¶…å‡ºçª—å£çš„æ—§æ¶ˆæ¯è‡ªåŠ¨ç”Ÿæˆæ–‡æœ¬æ‘˜è¦ï¼Œä¿ç•™å…³é”®ä¿¡æ¯
- **çº¿ç¨‹å®‰å…¨**: RWMutex ä¿æŠ¤ï¼Œæ”¯æŒå¤š Agent å¹¶å‘è¯»å†™

## 12.4 é”™è¯¯éš”ç¦»ä¸é™çº§ç­–ç•¥

ç³»ç»Ÿåœ¨å¤šä¸ªå±‚é¢å®ç°äº†å®¹é”™ï¼š

- **Router é™çº§**: æ„å›¾åˆ†ç±»å¤±è´¥æ—¶è‡ªåŠ¨é™çº§åˆ° ChatAgentï¼ˆé»˜è®¤ Agentï¼‰
- **Executor å…œåº•**: Agent æœªæ‰¾åˆ°æ—¶é™çº§åˆ° ChatAgent
- **é”™è¯¯ä¸ä¸­æ–­ Graph**: SubAgent æ‰§è¡Œé”™è¯¯è¿”å› `nil error`ï¼ŒGraph æµç¨‹ç»§ç»­æ‰§è¡Œ
- **Milvus è‡ªåŠ¨åˆå§‹åŒ–**: æ•°æ®åº“/Collection ä¸å­˜åœ¨æ—¶è‡ªåŠ¨åˆ›å»ºï¼Œæ— éœ€æ‰‹åŠ¨å»ºè¡¨

## 12.5 å‘é‡åº“è‡ªåŠ¨åŒ–ç®¡ç†

Milvus å®¢æˆ·ç«¯å®ç°äº†å®Œæ•´çš„è‡ªåŠ¨åŒ–åˆå§‹åŒ–é“¾è·¯ï¼š

1. è¿æ¥ default æ•°æ®åº“ â†’ æ£€æŸ¥ agent åº“æ˜¯å¦å­˜åœ¨
2. ä¸å­˜åœ¨åˆ™è‡ªåŠ¨åˆ›å»º agent æ•°æ®åº“
3. è¿æ¥ agent åº“ â†’ æ£€æŸ¥ biz Collection æ˜¯å¦å­˜åœ¨
4. ä¸å­˜åœ¨åˆ™è‡ªåŠ¨åˆ›å»º Schema + AUTOINDEX ç´¢å¼• + åŠ è½½åˆ°å†…å­˜
5. å…³é—­ default è¿æ¥ï¼Œè¿”å› agent å®¢æˆ·ç«¯

è¿™ç§è®¾è®¡ä½¿å¾—ç³»ç»Ÿé¦–æ¬¡éƒ¨ç½²æ—¶æ— éœ€ä»»ä½•æ‰‹åŠ¨æ•°æ®åº“æ“ä½œã€‚

## 12.6 äº‹ä»¶ç´¢å¼•ä¼˜åŒ–

å®‰å…¨äº‹ä»¶ç´¢å¼•æ—¶çš„ä¼˜åŒ–æªæ–½ï¼š

- **å†…å®¹æ‹¼æ¥**: å°†æ ‡é¢˜ã€CVEã€ä¸¥é‡çº§åˆ«ã€å‚å•†ã€äº§å“ã€æè¿°ã€AI åˆ†æç­‰å¤šå­—æ®µæ‹¼æ¥ä¸ºå•ä¸€æ–‡æœ¬
- **é•¿åº¦æˆªæ–­**: å†…å®¹æˆªæ–­åˆ° 7000 å­—ç¬¦ï¼Œé¿å…è¶…å‡º Milvus VarChar 8192 é™åˆ¶
- **ç»“æ„åŒ–å…ƒæ•°æ®**: äº‹ä»¶ IDã€ä¸¥é‡çº§åˆ«ã€CVE IDã€é£é™©è¯„åˆ†ç­‰å­˜å…¥ JSON metadata å­—æ®µ
- **æ—¶é—´æˆ³è®°å½•**: `indexed_at` å­—æ®µè®°å½•ç´¢å¼•æ—¶é—´ï¼Œæ”¯æŒæ—¶é—´èŒƒå›´è¿‡æ»¤

## 12.7 Skill å·¥å…·é€‰æ‹©ä¼˜åŒ–

Skill æ‰§è¡Œå™¨æ ¹æ®æŠ€èƒ½å®šä¹‰åŠ¨æ€é€‰æ‹©å·¥å…·å­é›†ï¼Œè€ŒéåŠ è½½å…¨éƒ¨å·¥å…·ï¼š

```go
func (e *Executor) selectTools() []tool.BaseTool {
    // ä»å…¨å±€å·¥å…·æ˜ å°„ä¸­æŒ‰ Skill å®šä¹‰çš„ Tools åˆ—è¡¨é€‰æ‹©
    for _, name := range e.skill.Tools {
        if t, ok := toolMap[name]; ok {
            selected = append(selected, t)
        }
    }
    return selected
}
```

è¿™å‡å°‘äº† Agent çš„å·¥å…·é€‰æ‹©ç©ºé—´ï¼Œæé«˜äº†å·¥å…·è°ƒç”¨çš„å‡†ç¡®ç‡ã€‚

---

# ç¬¬åä¸‰ç«  é…ç½®ç®¡ç†ä¸éƒ¨ç½²

## 13.1 é…ç½®ç»“æ„

```yaml
# config.yaml
ds_think_chat_model:
  model: "deepseek-chat"
  api_key: "your-api-key"
  base_url: "https://api.deepseek.com"

ds_quick_chat_model:
  model: "deepseek-chat"
  api_key: "your-api-key"
  base_url: "https://api.deepseek.com"

doubao_embedding_model:
  api_key: "your-ark-api-key"
  model: "doubao-embedding"
```

## 13.2 éƒ¨ç½²æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           éƒ¨ç½²æ¶æ„                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚   â”‚Sentinelâ”‚   â”‚   Milvus    â”‚    â”‚
â”‚   â”‚   :8080     â”‚   â”‚   :19530    â”‚    â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚          â”‚                â”‚             â”‚
â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                                         â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚   â”‚   MySQL     â”‚   â”‚ Prometheus  â”‚    â”‚
â”‚   â”‚   :3306     â”‚   â”‚   :9090     â”‚    â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

# é™„å½•ï¼šå…³é”®æ–‡ä»¶ç´¢å¼•

| æ–‡ä»¶è·¯å¾„ | åŠŸèƒ½æè¿° |
|---------|---------|
| `internal/ai/agent/chat_pipeline/orchestration.go` | Chat Agent ç¼–æ’ |
| `internal/ai/agent/knowledge_index_pipeline/orchestration.go` | çŸ¥è¯†ç´¢å¼•ç¼–æ’ |
| `internal/ai/agent/plan_execute_replan/plan_execute_replan.go` | Plan-Execute æ¨¡å¼ |
| `internal/ai/models/open_ai.go` | LLM æ¨¡å‹é…ç½® |
| `internal/ai/embedder/embedder.go` | Embedding é…ç½® |
| `internal/ai/retriever/retriever.go` | å‘é‡æ£€ç´¢å™¨ |
| `internal/ai/indexer/indexer.go` | å‘é‡ç´¢å¼•å™¨ |
| `internal/ai/tools/*.go` | å·¥å…·å®ç° |
| `utility/client/client.go` | Milvus å®¢æˆ·ç«¯ |
| `utility/mem/mem.go` | ä¼šè¯è®°å¿† |

---

æ–‡æ¡£å®Œæˆã€‚
